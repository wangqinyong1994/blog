<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Reading fun</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Reading fun">
<meta property="og:url" content="https://github.com/wangqinyong1994/blog/index.html">
<meta property="og:site_name" content="Reading fun">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Reading fun">
  
    <link rel="alternate" href="/blog/atom.xml" title="Reading fun" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/blog/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Reading fun</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/blog/" id="subtitle">啊 呀妈呀</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://github.com/wangqinyong1994/blog"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-设计模式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2020/10/14/设计模式/" class="article-date">
  <time datetime="2020-10-14T15:04:14.000Z" itemprop="datePublished">2020-10-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2020/10/14/设计模式/">前端路线</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><table>
<thead>
<tr>
<th align="center">SN</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Creational</td>
<td align="center">根据创建对象的概念分为以下几类</td>
</tr>
<tr>
<td align="center">Class</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">Factory Method(工厂方法)</td>
<td align="center">通过将数据和事件接口化来构建若干个子类。</td>
</tr>
<tr>
<td align="center">Object</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">Abstract Factory(抽象工厂)</td>
<td align="center">建立若干族类的一个实例，这个实例不需要具体类的细节信息。</td>
</tr>
<tr>
<td align="center">Builder(建造者)</td>
<td align="center">将对象的构建方法和其实现形式分离开来，总是构建相同类型的对象。</td>
</tr>
<tr>
<td align="center">Prototype(原型)</td>
<td align="center">一个完全初始化的实例，用于拷贝</td>
</tr>
<tr>
<td align="center">Singleton(单例)</td>
<td align="center">一个类只有唯一的一个实例，这个实例在镇哥哥程序中有一个全局的访问点。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>Structural</th>
<th>根据创建对象块氛围以下几类</th>
</tr>
</thead>
<tbody><tr>
<td>Class</td>
<td></td>
</tr>
<tr>
<td>Adapter(适配器)</td>
<td>将不同类的接口进行匹配，调整，这样景观内部接口不兼容但是不同的类还是可以协同工作。</td>
</tr>
<tr>
<td>Bridge(桥接)</td>
<td>将对象的接口从其实现中分离出来，这样对象的实现和接口可以独立的变化。</td>
</tr>
<tr>
<td>Composite(组合)</td>
<td>通过将简单可组合的对象组合起来，构成一个完整的对象，这个对象的能力将会潮服哦这些组成部分的能力的综合，即会有新能力产生。</td>
</tr>
<tr>
<td>Decorator(装饰器)</td>
<td>动态给对象增加一些可替换的处理流程。</td>
</tr>
<tr>
<td>Facada(外观)</td>
<td>一个类隐藏了内部子系统的复杂度，只暴露出一些简单的接口。</td>
</tr>
<tr>
<td>Flyweight(享元)</td>
<td>一个细粒度对象，用于将包含在其他地方的信息在不同对象之间高效地共享。</td>
</tr>
<tr>
<td>Proxy(代理)</td>
<td>一个充当占位符的对象用来代表一个真实的对象。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>Behavioral</th>
<th>基于对象间作用方式来分类</th>
</tr>
</thead>
<tbody><tr>
<td>Class</td>
<td></td>
</tr>
<tr>
<td>Interpreter(解释器)</td>
<td>将语言元素包含在一个应用的一种方式，用于匹配目标语言的语法。</td>
</tr>
<tr>
<td>Template Method(模版方法)</td>
<td>在一个方法中为某个算法简历一层外壳，将算法的具体步骤交给子类去做。</td>
</tr>
<tr>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>Chain of Responsibility(响应链)</td>
<td>一种将请求在一串对象中传递的方式，寻找可以处理这个请求的对象。</td>
</tr>
<tr>
<td>Command(命令)</td>
<td>封装命令请求为一个对象，从而使记录日志，队列缓存请求，未处理请求进行错误处理 这些功能成为可能。？？？</td>
</tr>
<tr>
<td>Iterator(迭代器)</td>
<td>在不需要直到集合内部工作原理的情况下，顺序访问一个集合里的元素。</td>
</tr>
<tr>
<td>Mediator(中介者)</td>
<td>在类之间定义简化的通行方式，用于避免类之间显式的持有彼此的引用。</td>
</tr>
<tr>
<td>Observer(观察者)</td>
<td>用于将变化通知给多个类的方式，可以保证类之间的一致性。</td>
</tr>
<tr>
<td>State(状态)</td>
<td>当对象改变时，改变对象的行为。</td>
</tr>
<tr>
<td>Strateg(策略)</td>
<td>将算法封装到类中，将选择和实现分离开来。</td>
</tr>
<tr>
<td>Visitor(访问者)</td>
<td>为类增加新的操作而不改变类本身。</td>
</tr>
</tbody></table>
<h2 id="构造器模式"><a href="#构造器模式" class="headerlink" title="构造器模式"></a>构造器模式</h2><p>原：构造器是一个当新建对象的内存被分配后，用来初始化该对象的一个特殊函数。它是用来创建特殊类型对象的，首先它要准备使用的对象，其次在对象初次被创建时，通过接收参数，构造器用来对成员的属性和方法进行赋值。</p>
<p>白：其实就是创建一个空对象，然后赋值啊赋值。。。</p>
<h3 id="对象创建"><a href="#对象创建" class="headerlink" title="对象创建"></a>对象创建</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对象构建三种方式</span></span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> a = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br></pre></td></tr></table></figure>

<h3 id="属性设置"><a href="#属性设置" class="headerlink" title="属性设置"></a>属性设置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. a.b</span></span><br><span class="line"><span class="comment">// 2. a[b]</span></span><br><span class="line"><span class="comment">// 3.</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(newObject, <span class="string">'key'</span>, &#123;</span><br><span class="line">  value: <span class="string">'xxxxx'</span>,</span><br><span class="line">  writeable: <span class="literal">true</span>,</span><br><span class="line">  enumerable: <span class="literal">true</span>,</span><br><span class="line">  configurable: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 4.</span></span><br><span class="line"><span class="built_in">Object</span>.definePropertie(newObject, &#123;</span><br><span class="line">  key1: &#123;</span><br><span class="line">    value: <span class="string">'val1'</span>,</span><br><span class="line">    writeable: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  key2: &#123;</span><br><span class="line">    value: <span class="string">'val2'</span>,</span><br><span class="line">    writeable: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="使用原型的构造器"><a href="#使用原型的构造器" class="headerlink" title="使用原型的构造器"></a>使用原型的构造器</h3><p>js 函数中的 prototype，当调用 js 构造器创建一个对象时，构造函数 prototype 上的属性对于所创建的对象来说都看见。这样就可以创建多访问相同 prototype 的 Car 对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Car</span>(<span class="params">model, year, miles</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.model = model;</span><br><span class="line">  <span class="keyword">this</span>.year = year;</span><br><span class="line">  <span class="keyword">this</span>.miles = miles;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Car.prototype.toString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.model + <span class="string">''</span> + <span class="keyword">this</span>.miles;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// usage</span></span><br><span class="line"><span class="keyword">var</span> aaa = <span class="keyword">new</span> Car(<span class="string">'aaa'</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">var</span> bbb = <span class="keyword">new</span> Car(<span class="string">'bbb'</span>, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这样的话，单个toString()实例被所有的Car对象所共享了。</span></span><br></pre></td></tr></table></figure>

<h2 id="模块化模式"><a href="#模块化模式" class="headerlink" title="模块化模式"></a>模块化模式</h2><p>原：用来进一步模拟类的概念，通过这样一种方式：我可以在一个单一的对象中包含公有/私有方法和变量，从而从全局范围中屏蔽特定的部分。这个结果是可以减少我们的函数名称在页面中其他脚本区域定义的函数名称冲突的可能性。</p>
<p>白：建个模块对象，起个名字，类似[Symbol.xxx]，使上下文各种引用不冲突。其实就是闭包。</p>
<h3 id="创建一个自包含模块实现模块化模式"><a href="#创建一个自包含模块实现模块化模式" class="headerlink" title="创建一个自包含模块实现模块化模式"></a>创建一个自包含模块实现模块化模式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 闭包来一波</span></span><br><span class="line"><span class="keyword">var</span> module1 = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> count = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    increment: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> count++;</span><br><span class="line">    &#125;</span><br><span class="line">    reset: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      count = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// usage</span></span><br><span class="line">module1.increment();</span><br><span class="line">module1.reset()</span><br></pre></td></tr></table></figure>

<h3 id="含命名空间、公有-私有变量的模块化实现"><a href="#含命名空间、公有-私有变量的模块化实现" class="headerlink" title="含命名空间、公有/私有变量的模块化实现"></a>含命名空间、公有/私有变量的模块化实现</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> module2 = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> privateVar, privateMethod;</span><br><span class="line"></span><br><span class="line">  privateVar = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  privateMethod = <span class="function"><span class="keyword">function</span> (<span class="params">foo</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(foo);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    privateVar: <span class="string">'foo'</span>,</span><br><span class="line">    privateMethod: <span class="function"><span class="keyword">function</span> (<span class="params">bar</span>) </span>&#123;</span><br><span class="line">      privateVar++;</span><br><span class="line">      privateMethod(bar);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h3 id="购物车例子"><a href="#购物车例子" class="headerlink" title="购物车例子"></a>购物车例子</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> basketModule = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 私有</span></span><br><span class="line">  <span class="keyword">var</span> basket = [];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">privatefn1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">privatefn2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    addItem: <span class="function"><span class="keyword">function</span>(<span class="params">values</span>) </span>&#123;</span><br><span class="line">      basket.push(values);</span><br><span class="line">    &#125;,</span><br><span class="line">    getItemCount: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> basket.length;</span><br><span class="line">    &#125;,</span><br><span class="line">    doSomething: privatefn1,</span><br><span class="line">    getTotal: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    	<span class="keyword">var</span> q = <span class="keyword">this</span>.getItemCount();</span><br><span class="line">      retun q;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 就是把同类相关东西放到一起，一顿操作，拿到相关数据信息返回或者其他。。。</span></span><br></pre></td></tr></table></figure>

<h3 id="模块模式变体"><a href="#模块模式变体" class="headerlink" title="模块模式变体"></a>模块模式变体</h3><h4 id="import-mixing-导入混合"><a href="#import-mixing-导入混合" class="headerlink" title="import mixing(导入混合)"></a>import mixing(导入混合)</h4><p>展现如何将全局作为一个参数传入模块的匿名函数，这种方式允许我们导入全局，并且按照我们的想法在本地为这些全局起一个别名。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> module3 = (<span class="function"><span class="keyword">function</span> (<span class="params">JQ, _</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">privateMethod1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    JQ(<span class="string">'.container'</span>).html(<span class="string">'test'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">privateMethod2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(_.min([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    publicMethod: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      privateMethod1();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)(JQuery, _);</span><br><span class="line"></span><br><span class="line">module3.publicMethod();</span><br></pre></td></tr></table></figure>

<h4 id="Exports-导出"><a href="#Exports-导出" class="headerlink" title="Exports(导出)"></a>Exports(导出)</h4><p>这个变体允许我们声明全局对象而不用使用他们。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> module4 = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">module</span> = &#123;&#125;,</span><br><span class="line">    privateVar = <span class="string">'123'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">privateMethod</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">module</span>.publicProperty = <span class="string">'aaa'</span>;</span><br><span class="line">  <span class="built_in">module</span>.publicMethod = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(privateMethod);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">module</span>;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h3 id="优-缺点"><a href="#优-缺点" class="headerlink" title="优/缺点"></a>优/缺点</h3><p>优点：对于真正封装概念更清晰；支持私有数据，内部能访问私有外部不能访问。</p>
<p>缺点：</p>
<ol>
<li>因为我们采用不同的方式访问公有私有成员，因此当我们想改变这些成员可见性时，不得不在所有使用这些成员地方修改代码。</li>
<li>不能在对象之后添加的方法里面访问这些私有变量。</li>
</ol>
<h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><p>特点：全局、唯一</p>
<p>原则：单一职责</p>
<p>基本版：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> CreateSingleton = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> instance = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">if</span> (instance) &#123;</span><br><span class="line">      <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (instance = <span class="keyword">this</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line">CreateSingleton.prototype.getName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> CreateSingleton(<span class="string">'a'</span>);</span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> CreateSingleton(<span class="string">'b'</span>);</span><br><span class="line">a.getName(); <span class="comment">// a</span></span><br><span class="line">b.getName(); <span class="comment">// a</span></span><br></pre></td></tr></table></figure>

<p>代理版：将创建对象的操作和实例判断的操作进行解耦拆分，实现更小粒度的划分，符合单一职责原则。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只负责创建实例</span></span><br><span class="line"><span class="keyword">let</span> Singleton = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Singleton.prototype.getName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只负责判断实例</span></span><br><span class="line"><span class="keyword">let</span> ProxyCreateSingleton = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> instance = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (instance) &#123;</span><br><span class="line">      <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (instance = <span class="keyword">new</span> Singleton(name));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> ProxyCreateSingleton(<span class="string">'a'</span>);</span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> ProxyCreateSingleton(<span class="string">'b'</span>);</span><br><span class="line">a.getName(); <span class="comment">// a</span></span><br><span class="line">b.getName(); <span class="comment">// a</span></span><br></pre></td></tr></table></figure>

<h3 id="惰性单例"><a href="#惰性单例" class="headerlink" title="惰性单例"></a>惰性单例</h3><p>页面开始加载时候我们的实例是没有进行创建的，当我们点击之后才开始，通过惰性单例按需创建实例，提高性能。</p>
<h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><p>原：</p>
<ol>
<li>一个被称作被观察者的对象，维护一组被称为观察者的对象，这些对象依赖于被观察者，被观察者自动将自身的状态的任何变化通知给他们。</li>
<li>当一个被观察者需要将一些变化通知给观察者的时候，将采用广播的方式，这条广播可能包含特定于这条通知的一些数据。</li>
<li>当特定的观察者不再需要接受来自它所注册的被观察者的通知的时候，被观察者可以将其从无所维护的组中删除。</li>
<li>包含如下组件：<ol>
<li>被观察者：维护一组观察者，提供用于增加或移除观察者的方法。</li>
<li>观察者： 提供一个更新接口，用于当被观察者状态变化时得到通知。</li>
<li>具体的被观察者：状态变化时广播通知给观察者，保持具体的观察者信息。</li>
<li>具体的观察者：保持一个指向具体被观察者的引用，实现一个更新接口，用于观察，以便保证自身状态总是和观察者状态一致的。</li>
</ol>
</li>
</ol>
<p>白：被观察者放着(订阅)观察者(数组)，也就是观察者要注册到被观察者上，然后遍历执行。。</p>
<p>创建观察者:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObserverList</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.observerList = [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  add(obj) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.observerList.push(obj)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  empty()&#123;</span><br><span class="line">    <span class="keyword">this</span>.observerList = [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  count() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.observerList.length;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span>(index) &#123;</span><br><span class="line">    <span class="keyword">if</span> (index &gt; <span class="number">-1</span> &amp;&amp; index &lt; <span class="keyword">this</span>.observerList.length) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.observerList[index]<span class="string">''</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  insert(obj, index) &#123;</span><br><span class="line">    <span class="keyword">let</span> pointer = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.observerList.unshift(obj);</span><br><span class="line">      pointer = index;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index === <span class="keyword">this</span>.observerList.length) &#123;</span><br><span class="line">      <span class="keyword">this</span>.observerList.push(obj);</span><br><span class="line">      pointer = index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pointer</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  indexOf(obj, startIndex) &#123;</span><br><span class="line">    <span class="keyword">let</span> i = startIndex, pointer = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt; <span class="keyword">this</span>.observerList.length) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.observerList[i] === obj) &#123;</span><br><span class="line">        pointer = i;</span><br><span class="line">      &#125;</span><br><span class="line">      i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pointer;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  removeAt(index) &#123;</span><br><span class="line">    <span class="keyword">if</span> (index === <span class="number">0</span>) &#123;</span><br><span class="line">     <span class="keyword">this</span>.observerList.shift()</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index === <span class="keyword">this</span>.observerList.length - <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.observerList.pop()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建被观察者</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers = <span class="keyword">new</span> ObserverList();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  addObserver(observer) &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers.add(observer);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  removeObserver(observer) &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers.removeAt(<span class="keyword">this</span>.observers.indexOf(observer, <span class="number">0</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  notify(context) &#123;</span><br><span class="line">    <span class="keyword">let</span> observerCount = <span class="keyword">this</span>.observers.count();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; observerCount; i++) &#123;</span><br><span class="line">      <span class="keyword">this</span>.observers.get(i).update(context);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>建立新的观察者的一个框架</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.update = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="观察者模式与发布订阅模式的不同"><a href="#观察者模式与发布订阅模式的不同" class="headerlink" title="观察者模式与发布订阅模式的不同"></a>观察者模式与发布订阅模式的不同</h3><p>原：</p>
<ol>
<li>观察者模式要求想要接受相关通知的观察者<strong>必须到发起这个事件的被观察者上注册这个事件</strong>。</li>
<li>发布订阅模式使用一个主题/事件频道，这个频道处于想要获取通知的订阅者和发起事件的发布者之间。这个事件系统允许代码定义应用相关的事件，这个事件可以传递特殊的参数，参数重包含有订阅着所需要的值。<strong>这种想法是为了避免订阅者和发布者之间的依赖性。</strong>这种使订阅着可以实现一个合适的事件处理函数，用于注册和接受由发布者广播的相关通知。</li>
</ol>
<p>白：发布订阅由中间商处理。</p>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk9m5h2kalj313w0u049e.jpg" alt></p>
<h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><p>优点：</p>
<ol>
<li>鼓励人找出不同部门间的关系，同时帮助我们找出这样的层，该层中包含的直接关系，可以通过一系列的观察者和被观察者替换掉。这种方式将应用程序切割降耦。</li>
<li>当我们需要维护相关对象的一致性时，可以避免对象之间的紧密耦合。eg. 一个对象可以通知及另一个对象，而不需要知道这个对象的信息。</li>
</ol>
<p>缺点：其实都是没有强关联导致的，既是好处也是坏处。</p>
<ol>
<li>假设发布者有一个或者多个订阅着正在监听它们，基于这种假设，在某些应用处理过程中来记录或者输出错误日志，如果订阅者执行日志功能崩溃了，因为系统解耦，发布者没法感知道这些事情。。。(订阅者坏掉了，发布者感知不到。 = =那肯定啊)</li>
<li>订阅者对彼此之间存在没有感知，对切换发布者的代价无从得知，因为订阅者和发布者之间的动态关系，更新依赖也很难去追踪。</li>
</ol>
<p>EventEmitter</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventEmitter</span> </span>&#123;</span><br><span class="line">  consturctor() &#123;</span><br><span class="line">    <span class="keyword">this</span>._event = <span class="built_in">Object</span>.create(<span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  on(type, handler) &#123;</span><br><span class="line">    (<span class="keyword">this</span>._event[type] || (<span class="keyword">this</span>._event[type] = [])).push(handler);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  off(type, handler) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>._event[type]) &#123;</span><br><span class="line">      <span class="keyword">this</span>._event[type].splice(<span class="keyword">this</span>._event[type].indexOf(handler) &gt;&gt;&gt; <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  once(type, handler) &#123;</span><br><span class="line">    <span class="keyword">let</span> fired = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">magic</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.off(type, magic);</span><br><span class="line">      <span class="keyword">if</span> (fired) &#123;</span><br><span class="line">        fired = <span class="literal">true</span>;</span><br><span class="line">        handler.apply(<span class="keyword">this</span>, args);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.on(type, magic);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  emit(type) &#123;</span><br><span class="line">    <span class="keyword">let</span> payload = [].slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> array = <span class="keyword">this</span>._event[type] || [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> handler = <span class="keyword">this</span>._event[type][i];</span><br><span class="line">      handler.apply(<span class="keyword">this</span>, payload);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// usage</span></span><br><span class="line"><span class="keyword">var</span> em = <span class="keyword">new</span> EventEmitter();</span><br><span class="line">em.on(<span class="string">'test'</span>, (aaa) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">123</span>, aaa);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">em.emit(<span class="string">'test'</span>, <span class="string">'dssd'</span>);</span><br></pre></td></tr></table></figure>

<h2 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h2><p>原：如果系统组件之间存在大量的直接关系，就可能是时候，使用一个中心的控制点，来让不同的组件通过它来通信。中介者通过将组件之间显式的直接引用替换成通过中心点来交互的方式，来做到松耦合。举个 🌰，飞行控制系统，一个航站塔(中介者)处理哪个飞机可以起飞哪个可以降落，因为所有通信(监听的通知或者广播的通知)都是飞机和控制塔之间进行的，而不是飞机与飞机之间。一个中央集权的控制中心是这个系统成功的关键。</p>
<p>白：就是上面 🌰。。。</p>
<p>从实现角度来讲，中介者模式是观察者模式中的共享被观察者对象，在这个系统中的对象之间直接的发布订阅关系被牺牲掉了，取代的是维护一个通信的中心节点。</p>
<p>也可以认为是一种补充——用于应用级别的通知，例如不同子系统之间的通信，子系统本身很复杂，可能需要使用发布订阅模式来做内部组件之间的解耦。</p>
<h3 id="基础实现"><a href="#基础实现" class="headerlink" title="基础实现"></a>基础实现</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mediator = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 可广播或收听的主题的存储器</span></span><br><span class="line">  <span class="keyword">var</span> topics = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 订阅主题时，提供要执行的回调</span></span><br><span class="line">  <span class="comment">// 当那个话题被广播</span></span><br><span class="line">  <span class="keyword">var</span> subscribe = <span class="function"><span class="keyword">function</span> (<span class="params">topic, fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!topics[topic]) &#123;</span><br><span class="line">      topics[topic] = [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    topics[topic].push(&#123; <span class="attr">context</span>: <span class="keyword">this</span>, <span class="attr">callback</span>: fn &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将事件发布/广播到应用程序的其余部分</span></span><br><span class="line">  <span class="keyword">var</span> publish = <span class="function"><span class="keyword">function</span> (<span class="params">topic</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> args;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!topics[topic]) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    args = <span class="built_in">Array</span>.prototypr.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = topics[topic].length; i &lt; l; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> subscription = topics[topic][i];</span><br><span class="line">      subscription.callback.apply(subscription.context, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    publish,</span><br><span class="line">    subscribe,</span><br><span class="line">    installTo: <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">      obj.subscribe = subscribe;</span><br><span class="line">      obj.publish = publish;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h3 id="优缺点-1"><a href="#优缺点-1" class="headerlink" title="优缺点"></a>优缺点</h3><p>优点：</p>
<ol>
<li>节约了对象或者组件之间的通信信道，这些对象或者组件存在于从多对多到多对一的系统之中。</li>
</ol>
<p>缺点：</p>
<ol>
<li>它引入一个单点故障。在模块直击爱你防止一个中间人也可能会造成性能损失，因为它们经常是间接的进行通信的。</li>
</ol>
<h3 id="中介者-VS-观察者-？？"><a href="#中介者-VS-观察者-？？" class="headerlink" title="中介者 VS 观察者 ？？"></a>中介者 VS 观察者 ？？</h3><ol>
<li>在观察者模式中，没有封装约束的单一对象。取而代之，观察者和主题必须合作来维护约束，通信的模式决定于观察者和主题相互关联的方式：一个单独的主题经常有许多的观察者，而有时候一个主题的观察者是另一个观察者的主题。</li>
<li>中间人和观察者都提倡松耦合，然而中间人默认使用让对象严格通过中间人进行通信的方式实现松耦合。观察者模式则创造了观察者对象，这些观察者对象会发布触发对象认购的感兴趣的事件。</li>
</ol>
<h2 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h2><p>原：基于原型的继承中，我们创建作为其他对象原型的对象。原型对象自身被当作构造器创建的每一个对象的蓝本高效的使用着。如果构造函数使用的原型包含例如叫做 name 的属性，那么每一个通过同一个构造器创建的对象豆浆拥有这个相同的属性。</p>
<p>白：其实就是创建一个 base 原型。使用 Object.create。。。。</p>
<p>eg：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myCar = &#123;</span><br><span class="line">  name: <span class="string">'aaa'</span>,</span><br><span class="line">  dirve: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'dirve'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  panic: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'panic'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> yourCar = <span class="built_in">Object</span>.create(myCar);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(yourCar.name); <span class="comment">// 可以看见原型</span></span><br></pre></td></tr></table></figure>

<p>Object.create。。。实现思路</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">  F.prototype = obj;</span><br><span class="line">  F.prototype.constructor = F;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h2><p>原：该模式目标是将方法的调用，请求或者操作封装到一个单独的对象中，给我们酌情执行同时参数化和传递方法调用的能力。</p>
<p>白：封装完调用方法。。。lodash、underscore??</p>
<p>实现简单明智的命令对象，将一个行为和对象对调用这个行为的需求都绑定到了一起，它们始终都包含一个执行操作(run()或者 execute())，所有带有相同接口的命令对象能够被简单的根据需要调换。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> CarManager = &#123;</span><br><span class="line">    requestInfo: <span class="function"><span class="keyword">function</span> (<span class="params">model, id</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> model + id + <span class="string">''</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    buyVehicle: <span class="function"><span class="keyword">function</span> (<span class="params">model, id</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> model + id + <span class="string">''</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    arrangeViewing: <span class="function"><span class="keyword">function</span> (<span class="params">model, id</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> model + id + <span class="string">''</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这样的话，如果CarManager核心api改变了，者可能需要所有直接访问这些方法的对象也跟着被修改，这可以被看作是种耦合。咋办？</span></span><br><span class="line"><span class="comment">// 扩展一波，以便我们这个命令模式的应用程序得到这种效果：接受任何可以在CarManager对象上面执行的方法，传送任何可以被使用的数据，如Car模型和ID</span></span><br></pre></td></tr></table></figure>

<p>希望的效果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CarManager.execute = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    CarManager[name] &amp;&amp;</span><br><span class="line">    CarManager[name].apply(CarManager, [].slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>))</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>最终调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CarManager.execute(<span class="string">'arrangeViewing'</span>, <span class="string">'Ferrari'</span>, <span class="string">'14523'</span>);</span><br><span class="line">CarManager.execute(<span class="string">'requestInfo'</span>, <span class="string">'Ford Mondeo'</span>, <span class="string">'54323'</span>);</span><br><span class="line">CarManager.execute(<span class="string">'requestInfo'</span>, <span class="string">'Ford Escort'</span>, <span class="string">'34232'</span>);</span><br><span class="line">CarManager.execute(<span class="string">'buyVehicle'</span>, <span class="string">'Ford Escort'</span>, <span class="string">'34232'</span>);</span><br></pre></td></tr></table></figure>

<p>更像是对已有对象，封装了添加外部执行的方法。</p>
<h2 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h2><p>原：该模式提供了面向一种更大型的代码体提供了一个更高级别的舒适的接口，隐藏了其真正的潜在复杂性。把这一模式想象成要是呈现给开发者简化的 API。，一些总是会提升使用性能的东西。</p>
<p>白：内部消化逻辑代码，提供给开发者更简单的 API，其实就是封装复杂逻辑块，按逻辑分层搞代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">module</span> = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _private = &#123;</span><br><span class="line">    i: <span class="number">5</span>,</span><br><span class="line">    <span class="keyword">get</span>: function () &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.i);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">set</span>: function (val) &#123;</span><br><span class="line">      <span class="keyword">this</span>.i = val;</span><br><span class="line">    &#125;,</span><br><span class="line">    run: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'running'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    jump: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'jumping'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    facade: <span class="function"><span class="keyword">function</span> (<span class="params">args</span>) </span>&#123;</span><br><span class="line">      _private.set(args.val);</span><br><span class="line">      _private.get();</span><br><span class="line">      <span class="keyword">if</span> (args.run) &#123;</span><br><span class="line">        _private.run();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.facade(&#123; <span class="attr">run</span>: <span class="literal">true</span>, <span class="attr">val</span>: <span class="number">10</span> &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h2><p>原：一种关注对象创建概念的创建模式。不同之处在于它没有明确要求我们使用一个构造器。取而代之，一个工厂能提供一个创建对象的公共接口，我们可以在其中指定我们希望被创建的工厂对象的类型。</p>
<p>白：创建基础类，之后按照这个类来建东西。</p>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ol>
<li>当我们的对象或者组件设置涉及到高程度级别的复杂度时。</li>
<li>当我们需要根据我们所在的环境方便的生成不同对象的实体时。</li>
<li>当我们在许多共享同一个属性的许多小型对象或组件上工作时。</li>
<li>当带有其他仅仅需要满足一种 API 约定的对象的组合对象工作时。 ？？</li>
</ol>
<h3 id="抽象工厂"><a href="#抽象工厂" class="headerlink" title="抽象工厂"></a>抽象工厂</h3><ol>
<li>目标是以一个通用的目标将一组独立的工厂进行封装。它将一对对象的实现细节从它们的一般实例中分离。</li>
<li>一般用于在一种必须从其创建或生产对象的方式处独立，或者需要同多种类型的对象一起工作。</li>
</ol>
<p>🌰：一个发动机工厂,它定义了获取或者注册发动机类型的方式.抽象工厂会被命名为 AbstractVehicleFactory.抽象工厂将允许像”car”或者”truck”的发动机类型的定义,并且构造工厂将仅实现满足发动机合同的类.(例如:Vehicle.prototype.driven 和 Vehicle.prototype.breakDown)。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> AbstractVehicleFactory = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> types = &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getVehicle: <span class="function"><span class="keyword">function</span> (<span class="params">type, customizations</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> Vehicle = types[type];</span><br><span class="line">      <span class="keyword">return</span> Vehicle ? <span class="keyword">new</span> Vehicle(customizations) : <span class="literal">null</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    registerVehicle: <span class="function"><span class="keyword">function</span> (<span class="params">type, Vehicle</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> proto = Vehicle.prototype;</span><br><span class="line">      <span class="keyword">if</span> (proto.drive &amp;&amp; proto.breakDown) &#123;</span><br><span class="line">        types[type] = Vehicle;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> AbstractVehicleFactory;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// usage</span></span><br><span class="line">AbstractVehicleFactory.registerVehicle(<span class="string">'car'</span>, Car);</span><br><span class="line">AbstractVehicleFactory.registerVehicle(<span class="string">'truck'</span>, Truck);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> car = AbstractVehicleFactory.getVehicle(<span class="string">'car'</span>, &#123;</span><br><span class="line">  color: <span class="string">'lime grern'</span>,</span><br><span class="line">  state: <span class="string">'link new'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> truck = AbstractVehicleFactory.getVehicle(<span class="string">'truck'</span>, &#123;</span><br><span class="line">  wheelSize: <span class="string">'lime grern'</span>,</span><br><span class="line">  color: <span class="string">'link new'</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Mixin-模式"><a href="#Mixin-模式" class="headerlink" title="Mixin 模式"></a>Mixin 模式</h2><p>原：提供能被一个或者一组子类简单继承功能的类，意在重用功能。</p>
<p>白：继承。。。原型链拓展。。。类比早期 react 的 mixin，vue 的 mixins。。。</p>
<h3 id="优缺点-2"><a href="#优缺点-2" class="headerlink" title="优缺点"></a>优缺点</h3><p>优点：在一个系统中降解功能的重复性，增加功能的重用性。</p>
<p>缺点：将功能注入对象原型会造成原型污染，造成一定程度上的原油功能的不确定性。</p>
<h2 id="装饰器模式"><a href="#装饰器模式" class="headerlink" title="装饰器模式"></a>装饰器模式</h2><p>原：提供了向一个系统中现有的类动态添加行为的能力，不关心类的基础功能，只是将它自身拷贝到超类之中。</p>
<p>白：手机与手机壳的关系。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多个装饰器的装饰对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MacBook</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.cost = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">this</span>.screenSize = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">15</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重写里面的方法</span></span><br><span class="line"><span class="comment">// 装饰器1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Memory</span>(<span class="params">macbook</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> v = macbook.cost();</span><br><span class="line">  macbook.cost = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> v + <span class="number">75</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器2</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Engraving</span>(<span class="params">macbook</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> v = macbook.cost();</span><br><span class="line">  macbook.cost = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> v + <span class="number">200</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器3</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Insurance</span>(<span class="params">macbook</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> v = macbook.cost();</span><br><span class="line">  macbook.cost = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> v + <span class="number">250</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mb = <span class="keyword">new</span> MacBook();</span><br><span class="line">Memory(mb);</span><br><span class="line">Engraving(mb);</span><br><span class="line">Insurance(mb);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(mb.cost()); <span class="comment">// 100 + 75 + 200 + 250</span></span><br><span class="line"><span class="built_in">console</span>.log(mb.screenSize()); <span class="comment">// 15</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 装饰类</span></span><br><span class="line">@testDec</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testDec</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  target.isDec = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Demo.isDec); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰器原理</span></span><br><span class="line">@decorator</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;&#125;</span><br><span class="line">A = decorator(A) || A;</span><br><span class="line"></span><br><span class="line"><span class="comment">//可以传参数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testDec</span>(<span class="params">isDec</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">target</span>) </span>&#123;</span><br><span class="line">    target.isDec = isDec;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// usage</span></span><br><span class="line">@testDec(tue)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(Demo.isDec); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>主要使用装饰类和装饰方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 装饰类</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mixins</span>(<span class="params">...list</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">target</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">Object</span>.assgin(target.prototype, ...list);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Foo = &#123;</span><br><span class="line">  foo() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'foo'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@mixins(Foo)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">const</span> myClass = <span class="keyword">new</span> MyClass();</span><br><span class="line">myClass.foo(); <span class="comment">// 'foo'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰方法</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readonly</span>(<span class="params">target, name, descriptor</span>) </span>&#123;</span><br><span class="line">  descriptor.writable = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> descriptor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.first = <span class="string">'A'</span>;</span><br><span class="line">    <span class="keyword">this</span>.last = <span class="string">'B'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @readonly</span><br><span class="line">  name() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.first&#125;</span> <span class="subst">$&#123;<span class="keyword">this</span>.last&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person();</span><br><span class="line"><span class="built_in">console</span>.log(p.name()); <span class="comment">// name只读，会报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印日志</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">target, name, descriptor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> oldValue = descriptor.value;</span><br><span class="line"></span><br><span class="line">  descriptor.value = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;name&#125;</span>`</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> oldValue.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> descriptor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Math</span> </span>&#123;</span><br><span class="line">  @log</span><br><span class="line">  add(a, b) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> math = <span class="keyword">new</span> <span class="built_in">Math</span>();</span><br><span class="line"><span class="keyword">const</span> result = math.add(<span class="number">2</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<h3 id="优缺点-3"><a href="#优缺点-3" class="headerlink" title="优缺点"></a>优缺点</h3><p>好多设计模式是优点同时也是缺点。。。</p>
<p>优点：对象可以用新的行为装饰从而继续使用，并不用担心基础对象被改变。</p>
<p>缺点：使应用程序变得复杂更难管理</p>
<h2 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h2><p>原：将一个对象或者类的接口翻译成某个指定的系统可以使用另外一个接口。</p>
<p>白：iphone 港版充电器与国行充电器，转接口。</p>
<h2 id="享元模式"><a href="#享元模式" class="headerlink" title="享元模式"></a>享元模式</h2><p>原：是一个优化重复、缓慢和低效数据共享代码的经典结构化解决方案。目标 hi 以相关对象尽可能多的共享数据，来减少应用程序中内存的使用。</p>
<p>白：为减少对象创建的个数。</p>
<p>当有大量对象时，有可能会造成内存溢出，我们将其中共同的部分抽象出来，如果有相同的业务请求，直接返回在内存中已有的对象，避免重新创建。</p>
<h3 id="优缺点-4"><a href="#优缺点-4" class="headerlink" title="优缺点"></a>优缺点</h3><p>优点：大大减少对象的创建，降低系统的内存，使效率提高</p>
<p>缺点：提高系统复杂度，需要分离出外部状态和内部状态，而且外部状态具有固有化性质，不应该随着内部状态变化而变化，否则会造成系统的混乱。</p>
<h2 id="MVC-模式"><a href="#MVC-模式" class="headerlink" title="MVC 模式"></a>MVC 模式</h2><p>原：一种架构设计模式，通过分离关注点的方式来改进应用组织方式。它促成了业务数据(Models)从用户界面(Views)中分离出来，还有第三个组成部分(Controllers)负责管理传统意义上的业务逻辑和用户输入。</p>
<p>白：Models 处理数据，Views 展示 UI，Controllers 搞搞逻辑。。。其实就是切分思想。</p>
<h3 id="对比-MVP"><a href="#对比-MVP" class="headerlink" title="对比 MVP"></a>对比 MVP</h3><p>P 代表展示器，在 MVP 中，P 观察着模型并且当模型发生改变的时候对视图进行更新，P 切实的将模型绑定到了视图，这一责任在 MVC 中被 Controller 提前持有了。</p>
<p>相较于 MVC 的好处是，增强了应用的可测试性，并提供了一个更加干净的视图和模型之间的隔离。</p>
<p>但是伴随着缺乏数据绑定支持的缺陷，意味着必须对这个任务做另外的处理。</p>
<h2 id="对比-MVVM"><a href="#对比-MVVM" class="headerlink" title="对比 MVVM"></a>对比 MVVM</h2><p>数据驱动，数据与页面绑定。。。类比 Vue</p>
<h2 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h2><p>原：描一组对象可像单个对象一样对待，这允许我们能统一的处理单个对象或多个对象，这意味着无论是一个对象还是一千个对象我们都能以通用行为处理。</p>
<p>白：就是封装一组行为。。。封装。📦</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单一节点</span></span><br><span class="line">$(<span class="string">'#a'</span>).addClass(<span class="string">'active'</span>);</span><br><span class="line">$(<span class="string">'#b'</span>).addClass(<span class="string">'active'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//一组节点</span></span><br><span class="line">$(<span class="string">'div'</span>).addClass(<span class="string">'active'</span>);</span><br><span class="line">$(<span class="string">'.item'</span>).addClass(<span class="string">'active'</span>);</span><br><span class="line">$(<span class="string">'input'</span>).addClass(<span class="string">'active'</span>);</span><br></pre></td></tr></table></figure>

<p>jQ 的 addClass</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单个多个一样的处理，多个要循环遍历</span></span><br><span class="line">addClass: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> classNames, i, l, elem, setClass, c, cl;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (jQuery.isFunction(value)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">j</span>) </span>&#123;</span><br><span class="line">      jQuery(<span class="keyword">this</span>).addClass(value.call(<span class="keyword">this</span>, j, <span class="keyword">this</span>.className));</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (value &amp;&amp; <span class="keyword">typeof</span> value === <span class="string">'string'</span>) &#123;</span><br><span class="line">    classNames = value.split(rspace);</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>, l = <span class="keyword">this</span>.length; i &lt; l; i++ ) &#123;</span><br><span class="line">      elem = <span class="keyword">this</span>[ i ];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ( elem.nodeType === <span class="number">1</span> ) &#123;</span><br><span class="line">        <span class="keyword">if</span> ( !elem.className &amp;&amp; classNames.length === <span class="number">1</span> ) &#123;</span><br><span class="line">          elem.className = value;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          setClass = <span class="string">" "</span> + elem.className + <span class="string">" "</span>;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">for</span> ( c = <span class="number">0</span>, cl = classNames.length; c &lt; cl; c++ ) &#123;</span><br><span class="line">            <span class="keyword">if</span> ( !~setClass.indexOf( <span class="string">" "</span> + classNames[ c ] + <span class="string">" "</span> ) ) &#123;</span><br><span class="line">              setClass += classNames[ c ] + <span class="string">" "</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          elem.className = jQuery.trim( setClass );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h2><p>原：提供一种方法顺序访问一个容器对象中的各个元素，而不需要暴露该对象的内部表示。</p>
<p>白：对象内部实现指针指向。。。[Symbol.iterator]</p>
<h2 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h2><p>当一个逻辑中，存在很多 if else 或者 switch，并且它们解决的问题是一样的，就可以使用。</p>
<p>白：把条件语句的表现形式通过对象键值对展现。</p>
<h2 id="责任链模式"><a href="#责任链模式" class="headerlink" title="责任链模式"></a>责任链模式</h2><p>原：很多对象由每一个对象对其下家引用而连接起来形成一条链，请求在这条链上传递，直到链上的某一个对象决定处理此请求。发出这个请求的客户端并不知道链上的哪一个对象最终处理这个请求，这使得系统可以在不影响客户端的情况下动态地重新组织和分配责任。</p>
<p>白：if else else if…</p>
<h2 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h2><p>原：代理以一种中间人的角色，帮我们处理我们无能为力的事情。</p>
<p>当我们遇到以下场景：</p>
<ul>
<li>无法直接访问某个对象</li>
<li>不想直接访问某个对象</li>
<li>访问某个对象存在困难</li>
</ul>
<p>就需要使用代理模式</p>
<p>白：代理处理我们的委托，去请求对象的结果</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/wangqinyong1994/blog/2020/10/14/设计模式/" data-id="ckh90iltq000h3ncwexc5db7m" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/前端-设计模式/">前端 设计模式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-关于npm" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2020/07/14/关于npm/" class="article-date">
  <time datetime="2020-07-14T15:04:14.000Z" itemprop="datePublished">2020-07-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2020/07/14/关于npm/">前端路线</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>工程化</p>
<h2 id="编辑器设置"><a href="#编辑器设置" class="headerlink" title="编辑器设置"></a>编辑器设置</h2><h3 id="Vscode-常用插件"><a href="#Vscode-常用插件" class="headerlink" title="Vscode 常用插件"></a>Vscode 常用插件</h3><ul>
<li><p>Git History</p>
</li>
<li><p>GitLens</p>
</li>
<li><p>Path Intellisense</p>
</li>
<li><p>Auto Close Tag</p>
</li>
<li><p>Auto Rename Tag</p>
</li>
<li><p>Color Highlight</p>
</li>
<li><p>VSCode Highlight Matching Tag</p>
</li>
<li><p>HTML CSS Support</p>
</li>
<li><p>Vetur</p>
</li>
<li><p>ES7 React/Redux/GraphQL/React-Native snippets</p>
</li>
<li><p>npm</p>
</li>
<li><p>npm Intellisense</p>
</li>
<li><p>Prettier - Code formatter</p>
</li>
<li><p>Live Server</p>
</li>
</ul>
<h2 id="Vscode-快捷键"><a href="#Vscode-快捷键" class="headerlink" title="Vscode 快捷键"></a>Vscode 快捷键</h2><ul>
<li><p>快捷键列表查看 <code>cmd + k</code> &amp; <code>cmd + s</code></p>
</li>
<li><p>快速打开文件 <code>cmd + p</code></p>
</li>
<li><p>编辑器命令<code>cmd + p</code> &amp; 输入 <code>&gt;</code></p>
</li>
<li><p>快速打开和关闭侧边栏 <code>cmd + b</code></p>
</li>
<li><p>快速打开集成终端 <code>control</code> + <em>`</em></p>
</li>
<li><p>代码格式化 <code>shift + option + f</code> || <code>cmd + k &amp; cmd + f</code></p>
</li>
<li><p>清除多余空格 <code>cmd + k &amp; cmd + x</code></p>
</li>
<li><p>折叠代码 <code>cmd + k &amp; cmd + (0|1|2|3|4)</code> 伸展代码 <code>cmd + k &amp; cmd + j</code></p>
</li>
<li><p>往上/下复制行 <code>shift + option + 上/下箭头</code></p>
</li>
<li><p>选择单词 局部选中<code>cmd + d</code> 全部选中<code>cmd + shift + l</code></p>
</li>
<li><p>文件中跳转符号 <code>cmd + p</code>之后输入<code>@</code></p>
</li>
<li><p>快速复制当前行 <code>cmd + shift + d</code></p>
</li>
<li><p>删除当前行 <code>cmd + x</code></p>
</li>
<li><p>往上/下同时编辑 <code>cmd + option + 上/下箭头</code></p>
</li>
</ul>
<h2 id="prettier"><a href="#prettier" class="headerlink" title="prettier"></a>prettier</h2><ol>
<li><p>编辑器中安装 prettier 插件</p>
</li>
<li><p>项目中安装 prettier</p>
</li>
<li><p><code>shift + cmd + p</code>打开用户首选项，用户区全局设置，工作区当前项目设置，添加 prettier 规则之后，格式化文档方式可选择 prettier，就以 prettier 的规则去格式化代码。项目中使用 prettier，需要进行代码格式化，需要下载 prettier 到开发环境，添加 script 命令 <code>&quot;prettier&quot;: &quot;prettier -c --write &#39;**/*.{js,jsx,tsx,ts,less,md,json}&#39;&quot;,</code>,项目中添加.prettierrc 自定义规则，添加.prettierignore 进行无需格式化代码文件配置。<img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk475fk5bcj311a0u01kx.jpg" alt="编辑器"></p>
</li>
</ol>
<h2 id="githooks"><a href="#githooks" class="headerlink" title="githooks"></a>githooks</h2><p>安装<code>husky</code> <code>lint-staged</code></p>
<p><code>package.json</code>添加如下配置，提交代码前进行 lint-staged 下的一系列流程，代码格式化之后进行 eslint 检测。</p>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gk47c7c6uqj311u0jqgo2.jpg" alt="package.json"></p>
<h2 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h2><h3 id="semver-语义化版本"><a href="#semver-语义化版本" class="headerlink" title="semver(语义化版本)"></a>semver(语义化版本)</h3><p>约定一个包的版本必须包含 3 个数字，格式必须是<code>MAJOR.MINOR.PATCH</code>(主版本.小版本.修订版本号)</p>
<ul>
<li>MAJOR 对应大版本迭代，做了不兼容旧版的修改时要更新此版本号</li>
<li>MINOR 对应小版本迭代，发生兼容旧版 API 的修改或功能更新时，更新 MINOR 版本号</li>
<li>PATCH 对应修订版本号，一般针对修复 BUG 的版本号</li>
</ul>
<table>
<thead>
<tr>
<th>range</th>
<th>含义</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td>^2.2.1</td>
<td>制定 MAJOR 版本号下所有更新的版本</td>
<td>匹配 2.2.3、2.3.0，不匹配 1.0.3、3.0.1</td>
</tr>
<tr>
<td>~2.2.1</td>
<td>制定 MAJOR.MINOR 版本号下所有更新的版本</td>
<td>匹配 2.2.3、2.2.9，不匹配 2.3.0、2.4.5</td>
</tr>
<tr>
<td>&gt;=2.1</td>
<td>版本号大于等于 2.1.0</td>
<td>匹配 2.1.2、3.1</td>
</tr>
<tr>
<td>&lt;=2.2</td>
<td>版本号小于等于 2.2.0</td>
<td>匹配 1.0.0、2.2.1、2.2.11</td>
</tr>
<tr>
<td>1.0.0-2.0.0</td>
<td>版本号从 1.0.0-2.0.0、包含各自</td>
<td>匹配 1.0.0、1.3.4、2.0.0</td>
</tr>
</tbody></table>
<p>两版本号可用空格(与)或者<code>||</code>(或)。</p>
<p>另外几种写法:</p>
<ul>
<li><code>*</code>或<code>x</code>匹配所有的主版本</li>
<li><code>1</code>或<code>1.x</code>匹配主版本号为 1 的所有版本</li>
<li><code>1.2</code>或<code>1.2.x</code>匹配版本号为 1.2 开头的所有版本</li>
<li>M.M.P 后面加<code>-</code>被视为不稳定、不建议生产使用的版本</li>
</ul>
<h3 id="scripts"><a href="#scripts" class="headerlink" title="scripts"></a>scripts</h3><p><code>npm run</code>运行时变量：在<code>npm run</code>的脚本执行环境内，可以通过环境变量方式获取许多运行时相关信息。以下都可以通过<code>process.env</code>对象访问获得</p>
<ul>
<li><code>npm_lifecycle_enent</code>:正在运行的脚本名称</li>
<li><code>npm_package_&lt;key&gt;</code>:获取当前包 package.json 中某个字段的配置值:如<code>npm_package_name</code>获取包名</li>
<li><code>npm_package_&lt;key&gt;_&lt;sub-key&gt;</code>: package.json 中嵌套字段属性：如<code>npm_package_dependencied_webpack</code>可以获取到 package.json 中的<code>dependencies.webpack</code>字段的值，即为 webpack 版本号</li>
</ul>
<h2 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h2><h3 id="version"><a href="#version" class="headerlink" title="version"></a>version</h3><p>遵循 server 规范，</p>
<p><code>npm view &lt;packageName&gt; version</code>查看某个模块的最新版本</p>
<p><code>npm view &lt;packageName&gt; versions</code>查看某个模块的所有历史版本</p>
<h3 id="descripting-amp-keywords"><a href="#descripting-amp-keywords" class="headerlink" title="descripting &amp; keywords"></a>descripting &amp; keywords</h3><p>相当于 npm 上的 seo</p>
<h3 id="dependencies-amp-devDependencies"><a href="#dependencies-amp-devDependencies" class="headerlink" title="dependencies &amp; devDependencies"></a>dependencies &amp; devDependencies</h3><ul>
<li>dependencies 生产环境依赖</li>
<li>devDependencies 开发环境依赖</li>
</ul>
<h3 id="scripts-1"><a href="#scripts-1" class="headerlink" title="scripts"></a>scripts</h3><p>使用<code>npm run xxx</code>去执行里面的脚本</p>
<h3 id="main"><a href="#main" class="headerlink" title="main"></a>main</h3><p>项目入口，不指定时默认根目录下<code>index.js</code>，发 npm 包会用到</p>
<h3 id="files"><a href="#files" class="headerlink" title="files"></a>files</h3><p>用于描述我们使用<code>npm publish</code>命令后推送到<code>npm</code>服务器的文件列表，如果指定文件夹，则文件夹内所有内容都会包含进来。eg. <code>files: [&#39;dist&#39;, &#39;lib&#39;, &#39;es&#39;]</code></p>
<h3 id="private"><a href="#private" class="headerlink" title="private"></a>private</h3><p>一般公司非开源项目，都会设置该值为<code>true</code>，因为<code>npm</code>拒绝发私有模块，通过设置该值可以防止私有模块被无意间发布出去。`</p>
<h3 id="engines"><a href="#engines" class="headerlink" title="engines"></a>engines</h3><p>针对 node 版本不同可能会导致的问题。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"engines": &#123;</span><br><span class="line">   "node": "&gt;= 8.16.0"</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>也可以指定适用的<code>npm</code>版本</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"engines": &#123;</span><br><span class="line">   "npm": "&gt;= 6.9.0"</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<h3 id="bin"><a href="#bin" class="headerlink" title="bin"></a>bin</h3><p>自定义命令</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"bin": &#123;</span><br><span class="line">  "my-app-cli": "./bin/cli.js"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上代码指定<code>my-app-cli</code>命令执行<code>bin</code>下的<code>cli.js</code>文件。</p>
<p>自定义实现时，需要在<code>cli.js</code>第一行写入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env node</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/wangqinyong1994/blog/2020/07/14/关于npm/" data-id="ckh90iltm000d3ncw8wjk1srz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/前端-工程化-npm/">前端 工程化 npm</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-异步与性能" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2019/09/15/异步与性能/" class="article-date">
  <time datetime="2019-09-15T03:47:44.000Z" itemprop="datePublished">2019-09-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2019/09/15/异步与性能/">异步与性能</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>现在与将来</strong></p>
<ol>
<li>setTimeout精度不高， 是因为事件循环。</li>
<li>一旦有事件需要运行， 事件循环就会运行， 知道队列清空。 事件循环的每一轮称谓一个tick。用户交互、IO和定时器都会向事件队列中加入事件。任意时刻， 一次只能从队列中处理一个事件。 执行事件的时候， 可能肢解或间接地引发一个或多个后续事件。</li>
</ol>
<p><strong>回调</strong></p>
<p><strong>Promise</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/wangqinyong1994/blog/2019/09/15/异步与性能/" data-id="ckh90iltk00093ncw2sza7xuf" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/中卷-异步与性能/">中卷 异步与性能</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-webpack相关" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2019/09/07/webpack相关/" class="article-date">
  <time datetime="2019-09-06T16:05:48.000Z" itemprop="datePublished">2019-09-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2019/09/07/webpack相关/">webpack相关</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h1><h2 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h2><p><a href="https://github.com/webpack/webpack">github webpack</a></p>
<p><a href="https://www.webpackjs.com/" target="_blank" rel="noopener">中文官网</a></p>
<p><a href="https://webpack.js.org/" target="_blank" rel="noopener">英文官网</a></p>
<ol>
<li>大模块<ul>
<li>entry</li>
<li>output</li>
<li>loader</li>
<li>plugins</li>
</ul>
</li>
</ol>
<h3 id="entry"><a href="#entry" class="headerlink" title="entry"></a>entry</h3><p>单入口语法： <code>entry: string | string[]</code></p>
<p>对象语法：<code>entry: { [entryChunkName: string]: string | string[] }</code></p>
<p>常见场景：</p>
<p>分离应用程序 app 与第三方库 vender</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: <span class="string">'./src/app.js'</span>,</span><br><span class="line">    vendors: <span class="string">'./src/vendors.js'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 该配置比较常见于只有一个入口起点的SPA</span></span><br><span class="line"><span class="comment">// 如果应用程序bundle中没有vendor，那么你可以在webpack中实现长缓存。</span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.webpackjs.com/guides/caching/" target="_blank" rel="noopener">缓存</a></p>
<p>mpa</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    p1: <span class="string">'./src/p1/index.js'</span>,</span><br><span class="line">    p2: <span class="string">'./src/p2/index.js'</span>,</span><br><span class="line">    p3: <span class="string">'./src/p3/index.js'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="output"><a href="#output" class="headerlink" title="output"></a>output</h3><p><strong>即使多入口，也只指定一个输出</strong></p>
<ul>
<li>filename: 输出文件文件名</li>
<li>path: 输出路径</li>
</ul>
<p>多入口起点</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: <span class="string">'./src/app.js'</span>,</span><br><span class="line">    search: <span class="string">'./src/search.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'[name].js'</span>,</span><br><span class="line">    path: __dirname + <span class="string">'/dist'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>cdn + 资源 hash</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config.js</span></span><br><span class="line">output: &#123;</span><br><span class="line">  path: <span class="string">'/xx/xx/assets/[hash]'</span>,</span><br><span class="line">  publicPath: <span class="string">'https://cdn.xxx.com/assets/[hash]/'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//编译时不知道最终输出文件的publicPath时，publicPath可以留空，并且在入口起点文件运行时动态设置。可在入口起点设置__webpack_public_path__</span></span><br><span class="line"></span><br><span class="line">__webpack_public_path__ = runtimePublicPath</span><br><span class="line"></span><br><span class="line"><span class="comment">// __webpack_对象_键__</span></span><br></pre></td></tr></table></figure>

<h3 id="mode"><a href="#mode" class="headerlink" title="mode"></a>mode</h3><p>Webpack4.x 以上，指定<code>mode</code> development/production</p>
<h3 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h3><p>3 中使用 loader 方式</p>
<ul>
<li>webpack.config.js 里配置</li>
<li>每个 import 语句中显示指定</li>
<li>shell 里指定</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">      use: [</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">'style-loader'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          loader: <span class="string">'css-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            modules: <span class="literal">true</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 内联</span></span><br><span class="line"><span class="keyword">import</span> Styles <span class="keyword">from</span> <span class="string">'style-loader!css-loader?modules!./styles.css'</span>;</span><br></pre></td></tr></table></figure>

<p>cli</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack --module-bind jade-loader --module-bind 'css=style-loader!css-loader'</span><br></pre></td></tr></table></figure>

<h4 id="loader-特性"><a href="#loader-特性" class="headerlink" title="loader 特性"></a>loader 特性</h4><ul>
<li><p>链式传递、配置处、由后往前、由下往上。</p>
</li>
<li><p>同步或异步</p>
</li>
<li><p>运行在 nodejs 中</p>
</li>
<li><p>可接受查询参数，用于 loader 传递配置</p>
</li>
<li><p>可使用 options 对象配置</p>
</li>
<li><p>可以将普通 npm 块导出为 loader，做法在 package.json 里定义一个 loader</p>
</li>
<li><p>plugin 可以配合 loader</p>
</li>
<li><p>loader 可产生额外的任意文件</p>
</li>
</ul>
<h4 id="loader-原理"><a href="#loader-原理" class="headerlink" title="loader 原理"></a>loader 原理</h4><p>导出函数，函数里返回字符串。。。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file-loader</span></span><br><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> filename = loaderUtils.interpolateName(<span class="keyword">this</span>, <span class="string">`[hash].[ext]`</span>, &#123;</span><br><span class="line">    content: source,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">this</span>.emitFile(filename, source);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`module.exports="<span class="subst">$&#123;filename&#125;</span>"`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">loader.raw = <span class="literal">true</span>;</span><br><span class="line"><span class="built_in">module</span>.exports = loader;</span><br><span class="line"></span><br><span class="line"><span class="comment">// url-loader</span></span><br><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>);</span><br><span class="line"><span class="keyword">const</span> mime = <span class="built_in">require</span>(<span class="string">'mime'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; limit &#125; = loaderUtils.getOptions(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">if</span> (limit &amp;&amp; limit &gt; source.length) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`module.exports = "data:<span class="subst">$&#123;mime.getType(</span></span></span><br><span class="line"><span class="string"><span class="subst">      <span class="keyword">this</span>.resourcePath</span></span></span><br><span class="line"><span class="string"><span class="subst">    )&#125;</span>;base64,<span class="subst">$&#123;source.toString(<span class="string">'base64'</span>)&#125;</span>"`</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'./file-loader'</span>).call(<span class="keyword">this</span>, source);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">loader.raw = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = loader;</span><br></pre></td></tr></table></figure>

<h4 id="loader-相关-api"><a href="#loader-相关-api" class="headerlink" title="loader 相关 api"></a>loader 相关 api</h4><ol>
<li><p>缓存 webpack 来提高编译效率 this.cacheable(); this.cacheable 原理？？</p>
</li>
<li><p>异步：当一个 loader 无依赖可异步的时候，不阻塞去执行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> callback = <span class="keyword">this</span>.async();</span><br><span class="line">  asyncAction(content, <span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> callback(err);</span><br><span class="line">    callback(<span class="literal">null</span>, result);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// this.async原理？？</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>传入源文件以 buffer 形式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports.raw = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取 loader 的 options</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> options = loaderUtils.getOptions(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">return</span> source;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>校验传入 options 是否符合要求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>);</span><br><span class="line"><span class="keyword">const</span> validate = <span class="built_in">require</span>(<span class="string">'schema-utils'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> json = &#123;</span><br><span class="line">  type: <span class="string">'object'</span>,</span><br><span class="line">  properties: &#123;</span><br><span class="line">    content: &#123;</span><br><span class="line">      type: <span class="string">'string'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> options = loaderUtils.getOptions(<span class="keyword">this</span>);</span><br><span class="line">  validate(json, options, <span class="string">'xxx-loader'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 不满足schema报错</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>loader 返回其他结果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// this.callback告诉webpack返回的结果</span></span><br><span class="line">  <span class="keyword">this</span>.callback(<span class="literal">null</span>, source, sourceMaps);</span><br><span class="line">  <span class="comment">// 当使用this.callback返回内容时，该loader必须返回undefind，以让webpack知道该loader返回结果在this.callback中，而不是在return中</span></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>同步与异步</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据实际情况去识别使用同步还是异步</span></span><br><span class="line"><span class="comment">// 异步demo</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> callback = <span class="keyword">this</span>.async();</span><br><span class="line">  asyncAction(source, <span class="function"><span class="keyword">function</span> (<span class="params">err, result, sourceMaps, ast</span>) </span>&#123;</span><br><span class="line">    callback(err, result, sourceMaps, ast);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>其他</p>
<ul>
<li>this.context 当前处理文件的所在目录</li>
<li>this.resource 当前处理文件的完整请求路径，包括 querystring</li>
<li>this.resourcePath 当前处理文件的路径</li>
<li>this.resourceQuery 当前处理文件的 querystring</li>
<li>this.target 等于 webpack 中 Target</li>
<li>this.loadModule(request: string, callback: function(err, source, sourceMap, module) {}) 处理一个文件时，如果依赖其他文件的处理结果才能得出当前文件的结果时</li>
<li>this.resolve(context: string, request: string, callback: function(err, res: string) {}) 像 require 语句一样获取指定文件的完整路径</li>
<li>this.addDependency(file: string) 给当前处理文件添加其依赖的文件，以便在其依赖文件变化时，会重新调用 loader 处理该文件</li>
<li>this.addContextDependency(directory: string) 把整个目录加入到当前正在处理文件的依赖中</li>
<li>this.clearDependencies 清楚当前正在处理文件的所有依赖</li>
</ul>
</li>
</ol>
<p>api 的原理？？</p>
<h3 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h3><p>插件是一个具有<code>apply</code>属性的 js 对象。<code>apply</code>属性会被 webpack compiler 调用，并且 compiler 对象可在整个编译生命周期访问。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ConsoleLogOnBuildWebpackPlugin.js</span></span><br><span class="line"><span class="keyword">const</span> pluginName = <span class="string">'ConsoleLogOnBuildWebpackPlugin'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConsoleLogOnBuildWebpackPlugin</span> </span>&#123;</span><br><span class="line">  apply(compiler) &#123;</span><br><span class="line">    compiler.hooks.run.tap(pluginName, (compilation) =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'webpack xxxxxx'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// compiler hook的tap方法第一个参数，要为插件名称，以便可以在所有hook中复用。</span></span><br></pre></td></tr></table></figure>

<p>另一种调用方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">const</span> configuration = <span class="built_in">require</span>(<span class="string">'./webpack.config.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> compiler = webpack(configuration);</span><br><span class="line">compiler.apply(<span class="keyword">new</span> webpack.ProgressPlugin());</span><br><span class="line">compiler.run(<span class="function"><span class="keyword">function</span> (<span class="params">err, stats</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//... error-first</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p><a href="https://github.com/webpack/tapable">Tapable</a></p>
<p>webpack 本质是一种事件流机制，工作流程是将各个插件串联起来，而实现这一切的核心就是 Tababl，webpack 中最核心的负责 Compiler 和负责创建 bundles 的 Compilation 都是 Tapable 的实例。</p>
<p>Tapable 的钩子</p>
<p><img src="https://tva1.sinaimg.cn/large/0081Kckwly1gkfth961gsj31120g2jvk.jpg" alt="Tapable的钩子"></p>
<table>
<thead>
<tr>
<th>钩子 name</th>
<th>执行方式</th>
<th>使用要点</th>
</tr>
</thead>
<tbody><tr>
<td>SyncHook</td>
<td>同步串行</td>
<td>不关心监听函数返回值</td>
</tr>
<tr>
<td>SyncBailHook(同步熔断)</td>
<td>同步串行</td>
<td>只要监听函数中有一个函数的返回值不为 null，则跳过剩下的所有逻辑</td>
</tr>
<tr>
<td>SyncWaterfallHook</td>
<td>同步串行</td>
<td>上一个监听函数的返回值可以传给下一个监听函数</td>
</tr>
<tr>
<td>SyncLoopHook</td>
<td>同步循环</td>
<td>当监听函数被触发的时候，如果该监听函数返回 true 则这个监听函数会反复执行，如果返回 undefined 则表示退出循环</td>
</tr>
<tr>
<td>AsyncParallelHook</td>
<td>异步并发</td>
<td>不关心监听函数返回值</td>
</tr>
<tr>
<td>AsyncParallelBailHook(异步熔断)</td>
<td>异步并发</td>
<td>只要监听函数返回值不为 null，就会忽略后面的监听函数执行，直接跳跃到 callAsync 等触发函数绑定的回调函数，然后执行这个被绑定的会调函数</td>
</tr>
<tr>
<td>AsyncSeriesHook</td>
<td>异步串行</td>
<td>不关心 callback()的灿忽视</td>
</tr>
<tr>
<td>AsyncSeriesBailHook</td>
<td>异步串行</td>
<td>callback()参数不为 null，就会直接执行 callAsync 等触发函数绑定的会调函数</td>
</tr>
<tr>
<td>AsyncSeriesWaterfallHook</td>
<td>异步串行</td>
<td>上一个监听函数中的 callback(err, data)的第二个参数，可以最为下一个监听函数的参数</td>
</tr>
</tbody></table>
<p>hooks 原理是发布订阅模式的实现。。。</p>
<p>同步串行</p>
<ol>
<li>SyncHook</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不关心监听函数返回值</span></span><br><span class="line"><span class="keyword">const</span> &#123; SyncHook &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>);</span><br><span class="line"><span class="keyword">const</span> queue = <span class="keyword">new</span> SyncHook([<span class="string">'name'</span>]); <span class="comment">// string[]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 订阅</span></span><br><span class="line">queue.tap(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name1, name2</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name1, name2, <span class="number">1</span>); <span class="comment">// webpack1 undefined 1</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">'1'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">queue.tap(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name1</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name1, <span class="number">2</span>); <span class="comment">// webpack 2</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">queue.tap(<span class="string">'3'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name1</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name1, <span class="number">3</span>); <span class="comment">// webpack 3</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发布</span></span><br><span class="line">queue.call(<span class="string">'webpack'</span>, <span class="string">'webpack-cli'</span>); <span class="comment">// 发布时触发订阅的函数，同时传入参数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原理</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SyncHook1</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks = [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 订阅</span></span><br><span class="line">  tap(name, fn) &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.push(fn);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发布</span></span><br><span class="line">  call() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.forEach(<span class="function">(<span class="params">hook</span>) =&gt;</span> hook(...arguments));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>SyncBailHook</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只要监听函数中有一个函数的返回值不为 null，则跳过剩下所有的逻辑</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; SyncBailHook &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> queue = <span class="keyword">new</span> SyncBailHook([<span class="string">'name'</span>]);</span><br><span class="line"></span><br><span class="line">queue.tap(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name, <span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue.tap(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name, <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'wrong'</span>;</span><br><span class="line">&#125;);</span><br><span class="line">queue.tap(<span class="string">'3'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name, <span class="number">3</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">queue.call(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行结果:</span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">webpack 1</span></span><br><span class="line"><span class="comment">webpack 2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原理</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SyncBailHook1</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks = [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 订阅</span></span><br><span class="line">  tap(name, fn) &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.push(fn);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发布</span></span><br><span class="line">  call() &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = <span class="keyword">this</span>.hooks.length; i &lt; l; i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> hook = <span class="keyword">this</span>.hooks[i];</span><br><span class="line">      <span class="keyword">let</span> result = hook(...arguments);</span><br><span class="line">      <span class="keyword">if</span> (result) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>SyncWaterfallHook</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上一个监听函数的返回值可以传给下一个监听函数</span></span><br><span class="line"><span class="keyword">const</span> &#123; SyncWaterfallHok &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> queue = <span class="keyword">new</span> SyncWaterfallHok([<span class="string">'name'</span>]);</span><br><span class="line"></span><br><span class="line">queue.tap(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">queue.tap(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data, <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">queue.tap(<span class="string">'3'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data, <span class="number">3</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">queue.call(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">返回</span></span><br><span class="line"><span class="comment">webpack 1</span></span><br><span class="line"><span class="comment">1 2</span></span><br><span class="line"><span class="comment">2 3</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原理</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SyncWaterfallHook1</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks = [];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 订阅</span></span><br><span class="line">  tap(name, fn) &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.push(fn);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发布</span></span><br><span class="line">  call() &#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = <span class="keyword">this</span>.hooks.length; i &lt; l; i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> hook = <span class="keyword">this</span>.hooks[i];</span><br><span class="line">      result = i == <span class="number">0</span> ? hook(...arguments) : hook(result);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>SyncLoopHook</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当监听函数被触发时，如果该监听函数返回true，则这个监听函数会反复执行，如果返回undefined则表示退出循环</span></span><br><span class="line"><span class="keyword">const</span> &#123; SyncLoopHook &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> queue = <span class="keyword">new</span> SyncLoopHook([<span class="string">'name'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> count = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">queue.tap(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'count: '</span>, count--);</span><br><span class="line">  <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">queue.call(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	返回</span></span><br><span class="line"><span class="comment">	count: 3</span></span><br><span class="line"><span class="comment">	count: 2</span></span><br><span class="line"><span class="comment">	count: 1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原理</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SyncLoopHook1</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hook = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 订阅</span></span><br><span class="line">  tap(name, fn) &#123;</span><br><span class="line">    <span class="keyword">this</span>.hook = fn;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发布</span></span><br><span class="line">  call() &#123;</span><br><span class="line">    <span class="keyword">let</span> result;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      result = <span class="keyword">this</span>.hook(...arguments);</span><br><span class="line">    &#125; <span class="keyword">while</span> (result);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>异步并行</p>
<ol>
<li><p>AsyncParallelHook</p>
<p>不关心监听函数返回值，有三种注册/发布的模式</p>
<table>
<thead>
<tr>
<th>异步订阅</th>
<th>调用方法</th>
</tr>
</thead>
<tbody><tr>
<td>tap</td>
<td>callAsync</td>
</tr>
<tr>
<td>tapAsync</td>
<td>callAsync</td>
</tr>
<tr>
<td>tapPromise</td>
<td>Promise</td>
</tr>
</tbody></table>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tap模式</span></span><br><span class="line"><span class="keyword">const</span> &#123; AsyncParallelHook &#125; = <span class="built_in">require</span>(<span class="string">'tapable'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> queue1 = <span class="keyword">new</span> AsyncParallelHook([<span class="string">'name'</span>]);</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'cost'</span>);</span><br><span class="line">queue1.tap(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name, <span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue1.tap(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name, <span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue1.tap(<span class="string">'3'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name, <span class="number">3</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue1.callAsync(<span class="string">'webpack'</span>, (err) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'cost'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	返回</span></span><br><span class="line"><span class="comment">	webpack 1</span></span><br><span class="line"><span class="comment">	webpack 2</span></span><br><span class="line"><span class="comment">	webpack 3</span></span><br><span class="line"><span class="comment">	cost: 4.520ms</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// tapAsync模式 回调形式</span></span><br><span class="line"><span class="keyword">const</span> queue2 = <span class="keyword">new</span> AsyncParallelHook([<span class="string">'name'</span>]);</span><br><span class="line">conole.time(<span class="string">'cost1'</span>);</span><br><span class="line">queue2.tapAsync(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name, <span class="number">1</span>);</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue2.tapAsync(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name, <span class="number">2</span>);</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue2.tapAsync(<span class="string">'3'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name, <span class="number">3</span>);</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">queue2.callAsync(<span class="string">'webpack'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'over'</span>);</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'cost1'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	返回</span></span><br><span class="line"><span class="comment">	webpack 1</span></span><br><span class="line"><span class="comment">	webpack 2</span></span><br><span class="line"><span class="comment">	webpack 3</span></span><br><span class="line"><span class="comment">	over</span></span><br><span class="line"><span class="comment">	time: 3004.xxxms</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// promise模式 promsie形式</span></span><br><span class="line"><span class="keyword">const</span> queue3 = <span class="keyword">new</span> AsyncParallelHook([<span class="string">'name'</span>]);</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'cost3'</span>);</span><br><span class="line">queue3.tapPromise(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(name, <span class="number">1</span>);</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">queue3.tapPromise(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(name, <span class="number">2</span>);</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">queue3.tapPromise(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(name, <span class="number">3</span>);</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">queue3.promise(<span class="string">'webpack'</span>).then(</span><br><span class="line">  () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'over'</span>);</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">'cost3'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'error'</span>);</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">'cost3'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	webpack 1</span></span><br><span class="line"><span class="comment">	webpack 2</span></span><br><span class="line"><span class="comment">	webpack 3</span></span><br><span class="line"><span class="comment">	over</span></span><br><span class="line"><span class="comment">	cost3: 3007.xxxms</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原理？？</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>AsyncParallelBailHook(异步并行熔断)</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只要监函数的返回值不为null，就会忽略后面的监听函数执行，直跳跃到callAsync等触发函数绑定的回调函数，然后执行这个被绑定的回调函数。</span></span><br><span class="line"><span class="keyword">const</span> queue1 = <span class="keyword">new</span> AsyncParallelBailHook([<span class="string">'name'</span>]);</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'cost'</span>);</span><br><span class="line">queue1.tap(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name, <span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue1.tap(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name, <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'wrong'</span>;</span><br><span class="line">&#125;);</span><br><span class="line">queue1.tap(<span class="string">'3'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name, <span class="number">3</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue1.callAsync(<span class="string">'webpack'</span>, (err) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'cost'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	返回</span></span><br><span class="line"><span class="comment">	webpack 1</span></span><br><span class="line"><span class="comment">	webpack 2</span></span><br><span class="line"><span class="comment">	cost: 4.xxxms</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> queue2 = <span class="keyword">new</span> AsyncParallelBailHook([<span class="string">'name'</span>]);</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'cost1'</span>);</span><br><span class="line">queue2.tapAsync(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name, <span class="number">1</span>);</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue2.tapAsync(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name, <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'wrong'</span>;</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue2.tapAsync(<span class="string">'3'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name, <span class="number">3</span>);</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">queue2.callAsync(<span class="string">'webpack'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'over'</span>);</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'cost1'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	webpack 1</span></span><br><span class="line"><span class="comment">	webpack 2</span></span><br><span class="line"><span class="comment">	webpack 3</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> queue3 = <span class="keyword">new</span> AsyncParallelBailHook([<span class="string">'name'</span>]);</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'cost3'</span>);</span><br><span class="line">queue3.tapPromise(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(name, <span class="number">1</span>);</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">queue3.tapPromise(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(name, <span class="number">2</span>);</span><br><span class="line">      reject(<span class="string">'wrong'</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">queue3.tapPromise(<span class="number">3</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(name, <span class="number">3</span>);</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">queue3.promise(<span class="string">'webpack'</span>).then(</span><br><span class="line">  () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'over'</span>);</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">'cost3'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'error'</span>);</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">'cost3'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">返回</span></span><br><span class="line"><span class="comment">webpack1</span></span><br><span class="line"><span class="comment">webpack2</span></span><br><span class="line"><span class="comment">error</span></span><br><span class="line"><span class="comment">cost3: 2008.xxxms</span></span><br><span class="line"><span class="comment">webpack 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>异步串行</p>
<ol>
<li>AsyncSeriesHook</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不关心callback()的参数</span></span><br><span class="line"><span class="keyword">const</span> queue1 = <span class="keyword">new</span> AsyncSeriesHook([<span class="string">'name'</span>]);</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'cost1'</span>);</span><br><span class="line">queue1.tap(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'wrong'</span></span><br><span class="line">&#125;)</span><br><span class="line">queue1.tap(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;)</span><br><span class="line">queue1.tap(<span class="string">'3'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;)</span><br><span class="line">queue1.callAsync(<span class="string">'zfpx'</span>, err =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'cost1'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	返回</span></span><br><span class="line"><span class="comment">	1</span></span><br><span class="line"><span class="comment">	2</span></span><br><span class="line"><span class="comment">	3</span></span><br><span class="line"><span class="comment">	undefined</span></span><br><span class="line"><span class="comment">	cost1: 3.9xxms</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> queue2 = <span class="keyword">new</span> AsyncSeriesHook([<span class="string">'name'</span>]);</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'cost2'</span>);</span><br><span class="line">queue2.tapAsync(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name, <span class="number">1</span>);</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line">queue2.tapAsync(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name, <span class="number">2</span>);</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line">queue2.tapAsync(<span class="string">'3'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">name, cb</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name,<span class="number">3</span>);</span><br><span class="line">    cb();</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">queue2.callAsync(<span class="string">'webpack'</span>, err =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'over'</span>);</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'cost2'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	返回</span></span><br><span class="line"><span class="comment">	webpack 1</span></span><br><span class="line"><span class="comment">	webpack 2</span></span><br><span class="line"><span class="comment">	webpack 3</span></span><br><span class="line"><span class="comment">	undefined</span></span><br><span class="line"><span class="comment">	over</span></span><br><span class="line"><span class="comment">	cost2: 6xxx.xxxms</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> queue3 = AsyncSeriesHook([<span class="string">'name'</span>]);</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'cost3'</span>);</span><br><span class="line">queue3.tapPromise(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(name, <span class="number">1</span>)</span><br><span class="line">      resolve()</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">queue3.tapPromise(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(name, <span class="number">2</span>)</span><br><span class="line">      resolve()</span><br><span class="line">    &#125;, <span class="number">2000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">queue3.tapPromise(<span class="string">'3'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(name, <span class="number">3</span>)</span><br><span class="line">      resolve()</span><br><span class="line">    &#125;, <span class="number">3000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">queue3.promise(<span class="string">'webpack'</span>).then(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err)</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'cost3'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	返回</span></span><br><span class="line"><span class="comment">	webpack 1</span></span><br><span class="line"><span class="comment">	webpack 2</span></span><br><span class="line"><span class="comment">	webpack 3</span></span><br><span class="line"><span class="comment">	undefined</span></span><br><span class="line"><span class="comment">	cost3: 6xxx.xxxms</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原理</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AsyncSeriesHook1</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks = []</span><br><span class="line">  &#125;</span><br><span class="line">  tapAsync(name, fn) &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.push(fn)</span><br><span class="line">  &#125;</span><br><span class="line">  callAsync() &#123;</span><br><span class="line">    <span class="keyword">let</span> self = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">let</span> args = [...arguments];</span><br><span class="line">    <span class="keyword">let</span> done = args.pop();</span><br><span class="line">    <span class="keyword">let</span> idx = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 如果next的参数有值，就直接跳跃到执行callAsync的回调函数</span></span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> done(err);</span><br><span class="line">      <span class="keyword">let</span> fn = self.hooks[idx++];</span><br><span class="line">      fn ? fn(..args, next) : done()</span><br><span class="line">    &#125;</span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>AsyncSeriesBailHook</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// callback()的参数不为null，就会直接执行callAsync等触发函数绑定的回调函数</span></span><br><span class="line"><span class="comment">// tap</span></span><br><span class="line"><span class="keyword">const</span> queue1 = <span class="keyword">new</span> AsyncSeriesBailHook([<span class="string">'name'</span>]);</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'cost1'</span>);</span><br><span class="line">queue1.tap(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'wrong'</span>;</span><br><span class="line">&#125;);</span><br><span class="line">queue1.tap(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue1.tap(<span class="string">'3'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue1.callAsync(<span class="string">'webpack'</span>, (err) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'cost1'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	返回</span></span><br><span class="line"><span class="comment">	1</span></span><br><span class="line"><span class="comment">	null</span></span><br><span class="line"><span class="comment">	cost1: 3.xxxms</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// tapAsync</span></span><br><span class="line"><span class="keyword">const</span> queue2 = <span class="keyword">new</span> AsyncSeriesBailHook([<span class="string">'name'</span>]);</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'cost2'</span>);</span><br><span class="line">queue2.tapAsync(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, callback</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name, <span class="number">1</span>);</span><br><span class="line">    callback();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue2.tapAsync(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, callback</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name, <span class="number">2</span>);</span><br><span class="line">    callback(<span class="string">'wrong'</span>);</span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue2.tapAsync(<span class="string">'3'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, callback</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name, <span class="number">3</span>);</span><br><span class="line">    callback();</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue2.callAsync(<span class="string">'webpack'</span>, (err) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'over'</span>);</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'cost2'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	返回</span></span><br><span class="line"><span class="comment">	webpack 1</span></span><br><span class="line"><span class="comment">	webpack 2</span></span><br><span class="line"><span class="comment">	wrong</span></span><br><span class="line"><span class="comment">	over</span></span><br><span class="line"><span class="comment">	cost2: 3xxx.xxxms</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// promise</span></span><br><span class="line"><span class="keyword">const</span> queue3 = <span class="keyword">new</span> AsyncSeriesBailHook([<span class="string">'name'</span>]);</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'cost3'</span>);</span><br><span class="line">queue3.tapPromise(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(name, <span class="number">1</span>);</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">queue3.tapPromise(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(name, <span class="number">2</span>);</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">queue3.tapPromise(<span class="string">'3'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(name, <span class="number">3</span>);</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">queue3.promise(<span class="string">'webpack'</span>).then(</span><br><span class="line">  (err) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'over'</span>);</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">'cost3'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  (err) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'over'</span>);</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">'cost3'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	返回</span></span><br><span class="line"><span class="comment">	webpack 1</span></span><br><span class="line"><span class="comment">	webpack 2</span></span><br><span class="line"><span class="comment">	undefined</span></span><br><span class="line"><span class="comment">	error</span></span><br><span class="line"><span class="comment">	cost3: 3xxx.xxxms</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>AsyncSeriesWaterfallHook</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上一个监听函数中的callback(err, data)的第二个参数，可以作为下一个监听函数的参数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// tap</span></span><br><span class="line"><span class="keyword">const</span> queue1 = <span class="keyword">new</span> AsyncSeriesWaterfallHook([<span class="string">'name'</span>]);</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'cost1'</span>);</span><br><span class="line">queue1.tap(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'aa'</span>;</span><br><span class="line">&#125;);</span><br><span class="line">queue1.tap(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>, data);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'bb'</span>;</span><br><span class="line">&#125;);</span><br><span class="line">queue1.tap(<span class="number">3</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>, data);</span><br><span class="line">&#125;);</span><br><span class="line">queue1.callAsync(<span class="string">'webpack'</span>, (err) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'over'</span>);</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'cost1'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	返回</span></span><br><span class="line"><span class="comment">	webpack 1</span></span><br><span class="line"><span class="comment">	2 aa</span></span><br><span class="line"><span class="comment">	3 bb</span></span><br><span class="line"><span class="comment">	null ??</span></span><br><span class="line"><span class="comment">	over</span></span><br><span class="line"><span class="comment">	cost1: 5.xxxms</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// tapAsync</span></span><br><span class="line"><span class="keyword">const</span> queue2 = <span class="keyword">new</span> AsyncSeriesWaterfallHook([<span class="string">'name'</span>]);</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'cost2'</span>);</span><br><span class="line">queue2.tapAsync(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name, callback</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'1: '</span>, name);</span><br><span class="line">    callback(<span class="literal">null</span>, <span class="number">2</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue2.tapAsync(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data, callback</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'2: '</span>, data);</span><br><span class="line">    callback(<span class="literal">null</span>, <span class="number">3</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue2.tapAsync(<span class="string">'3'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data, callback</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'3: '</span>, data);</span><br><span class="line">    callback(<span class="literal">null</span>, <span class="number">3</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line">queue2.callAsync(<span class="string">'webpack'</span>, (err) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'over'</span>);</span><br><span class="line">  <span class="built_in">console</span>.timeEnd(<span class="string">'cost2'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	返回</span></span><br><span class="line"><span class="comment">	1: webpack</span></span><br><span class="line"><span class="comment">	2: 2</span></span><br><span class="line"><span class="comment">	3: 3</span></span><br><span class="line"><span class="comment">	null</span></span><br><span class="line"><span class="comment">	over</span></span><br><span class="line"><span class="comment">	cost2: 6xxx.xxxms</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// promise</span></span><br><span class="line"><span class="keyword">const</span> queue3 = <span class="keyword">new</span> AsyncSeriesWaterfallHook([<span class="string">'name'</span>]);</span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'cost3'</span>);</span><br><span class="line">queue3.tapPromise(<span class="string">'1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'1: '</span>, name);</span><br><span class="line">      resolve(<span class="string">'1'</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">queue3.tapPromise(<span class="string">'2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'2: '</span>, name);</span><br><span class="line">      resolve(<span class="string">'2'</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">queue3.tapPromise(<span class="string">'3'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data, callback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'3: '</span>, data);</span><br><span class="line">      resolve(<span class="string">'over'</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">queue3.promise(<span class="string">'webpack'</span>).then(</span><br><span class="line">  (err) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">'cost3'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  (err) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">'cost3'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	返回</span></span><br><span class="line"><span class="comment">	1: webpack</span></span><br><span class="line"><span class="comment">	2: 1</span></span><br><span class="line"><span class="comment">	3: 2</span></span><br><span class="line"><span class="comment">	over</span></span><br><span class="line"><span class="comment">	cost3: 6xxx.xxxms</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原理</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AsyncSeriesWaterfallHook1</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks = [];</span><br><span class="line">  &#125;</span><br><span class="line">  tapAsync(name, fn) &#123;</span><br><span class="line">    <span class="keyword">this</span>.hooks.push(fn);</span><br><span class="line">  &#125;</span><br><span class="line">  callAsync() &#123;</span><br><span class="line">    <span class="keyword">let</span> self = <span class="keyword">this</span>,</span><br><span class="line">      args = [...arguments],</span><br><span class="line">      done = args.pop();</span><br><span class="line">    <span class="built_in">console</span>.log(args);</span><br><span class="line">    <span class="keyword">let</span> idx = <span class="number">0</span>,</span><br><span class="line">      result = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (idx &gt;= self.hooks.length) <span class="keyword">return</span> done();</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> done(err);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">let</span> fn = self.hooks[idx++];</span><br><span class="line">      <span class="keyword">if</span> (idx === <span class="number">1</span>) &#123;</span><br><span class="line">        fn(...args, next);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fn(data, next);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TODO: 几个 hooks 的发布订阅原理</p>
<p><a href="https://juejin.im/post/6844903573675835400" target="_blank" rel="noopener">详解</a></p>
<h3 id="webpack-compiler"><a href="#webpack-compiler" class="headerlink" title="webpack compiler"></a>webpack compiler</h3><p>webpack 的入口文件其实就实例了 Compiler 并调用了 run 方法进行了编译，webpack 的编译都按照如下钩子调用顺序执行。</p>
<ul>
<li>before-run 清楚缓存</li>
<li>run 注册缓存数据钩子</li>
<li>before-compile</li>
<li>compile 开始编译</li>
<li>make 从入口分析依赖以及间接依赖模块，创建模块对象</li>
<li>build-module 模块构建</li>
<li>seal 构建结果封装，不可再更改</li>
<li>after-compile 完成构建、缓存数据</li>
<li>emit 输出到 dist 目录</li>
</ul>
<h3 id="webpack-compilation"><a href="#webpack-compilation" class="headerlink" title="webpack compilation"></a>webpack compilation</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/wangqinyong1994/blog/2019/09/07/webpack相关/" data-id="ckh90ilt700003ncwgz501j91" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/webpack/">webpack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-类型与语法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2019/09/03/类型与语法/" class="article-date">
  <time datetime="2019-09-03T15:02:14.000Z" itemprop="datePublished">2019-09-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2019/09/03/类型与语法/">类型与语法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>类型、值</strong></p>
<ol>
<li><p>特别大和特别小的数字默认指数格式显示， 与toExponential() 的输出结果相同。</p>
</li>
<li><p>toPrecision()方法用来指定有效数位的显示位数。</p>
</li>
<li><p>数字的toFixed()可行写法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(42).toFixed(3); // &apos;42.000&apos;</span><br><span class="line">0.42.toFixed(3); // &apos;0.420&apos;</span><br><span class="line">42..toFixed(3); // &apos;42.000&apos;</span><br></pre></td></tr></table></figure>
</li>
<li><p>不是数字的数字 NaN(typeof NaN === ‘number’)</p>
</li>
<li><p>加法和减法不会得到负零(-0);乘除可以</p>
</li>
<li><p>特殊等式。可用ES6 Object.is(…)来判断两值是否绝对相等。建议能用 == 或 === 就用。</p>
</li>
</ol>
<p><strong>原生函数</strong></p>
<ol>
<li><p>所有typeof返回值为”object”的对象都包含一个内部属性[[Class]], 这个属性无法直接访问, 一般通过Object.prototype.toString()来查看。</p>
</li>
<li><p>拆封对象， 使用valueOf()。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var a = new String(&apos;abc&apos;);</span><br><span class="line">var b = new Number(42);</span><br><span class="line">var c = new Boolean(true);</span><br><span class="line"></span><br><span class="line">a.valueOf(); // &apos;abc&apos;</span><br><span class="line">b.valueOf(); // 42</span><br><span class="line">c.valueOf(); // true</span><br></pre></td></tr></table></figure>
</li>
<li><p>包含至少一个”空单元”的数组称为”稀疏数组”。</p>
</li>
<li><p>~x 大致等同于 ~(x + 1).</p>
</li>
<li><p>-1哨位值， 联想string.indexOf()</p>
</li>
<li><p>抽象渗漏: 代码中暴露了底层的实现细节。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var a = &apos;Hello World&apos;;</span><br><span class="line">~a.indexOf(&apos;lo&apos;); // -4 真值</span><br><span class="line">if(~a.indexOf(&apos;lo&apos;))&#123;&#125; // true</span><br><span class="line">~a.indexOf(&apos;ol&apos;) // 假值</span><br><span class="line">!~a.indexOf(&apos;ol&apos;) // true</span><br><span class="line">if(!~a.indexOf(&apos;ol&apos;)) &#123;&#125; // true</span><br><span class="line">// 如果indexOf(...)返回-1, ~将其转换为假值0, 其他情况一律转化为真值。</span><br></pre></td></tr></table></figure>
</li>
<li><p>字位截除 <del>同Math.floor(), 第一个</del>执行ToInt32并反转字位, 然后第二个再进行一次字位反转, 即将所有字位反转回原值, 最后得到的仍是ToInt32的结果。</p>
</li>
<li><p>[] + {} // “[object Object]”  {} + [] // 0</p>
</li>
<li><p>== 与 === 都会检查操作数类型， 区别在于操作数类型不同时它们的处理方式不同。不用考虑性能。</p>
</li>
<li><p>链式赋值如果未对声明， 就不会对其赋值。</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/wangqinyong1994/blog/2019/09/03/类型与语法/" data-id="ckh90iltl000b3ncwbnohavl9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/中卷-类型-值/">中卷 类型 值</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-对象" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2019/07/29/对象/" class="article-date">
  <time datetime="2019-07-29T15:19:24.000Z" itemprop="datePublished">2019-07-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2019/07/29/对象/">对象</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="1-忽视点"><a href="#1-忽视点" class="headerlink" title="1.忽视点"></a>1.忽视点</h4><h5 id="1-1-原话：-简单基本类型-string-boolean-number-null-undefined-本身并不是对象，-null-有时会被当做一种对象类型，-但是这其实只是语言本身的一个-bug，-即对-null-执行-typeof-会返回字符串’object’。实际上，-null-本身是基本类型。"><a href="#1-1-原话：-简单基本类型-string-boolean-number-null-undefined-本身并不是对象，-null-有时会被当做一种对象类型，-但是这其实只是语言本身的一个-bug，-即对-null-执行-typeof-会返回字符串’object’。实际上，-null-本身是基本类型。" class="headerlink" title="1.1 原话： 简单基本类型(string, boolean, number, null, undefined)本身并不是对象， null 有时会被当做一种对象类型， 但是这其实只是语言本身的一个 bug， 即对 null 执行 typeof 会返回字符串’object’。实际上， null 本身是基本类型。"></a>1.1 原话： 简单基本类型(string, boolean, number, null, undefined)本身并不是对象， null 有时会被当做一种对象类型， 但是这其实只是语言本身的一个 bug， 即对 null 执行 typeof 会返回字符串’object’。实际上， null 本身是基本类型。</h5><h5 id="1-2-1-内置对象"><a href="#1-2-1-内置对象" class="headerlink" title="1.2.1 内置对象"></a>1.2.1 内置对象</h5><h6 id="String-Number-Boolean-Object-Function-Array-Date-RegExp-Error"><a href="#String-Number-Boolean-Object-Function-Array-Date-RegExp-Error" class="headerlink" title="String Number Boolean Object Function Array Date RegExp Error"></a>String Number Boolean Object Function Array Date RegExp Error</h6><p>instanceof typeof Object.prototype.toString.call(xxx) 可以判断类型</p>
<h5 id="1-2-2-对象的属性描述符"><a href="#1-2-2-对象的属性描述符" class="headerlink" title="1.2.2 对象的属性描述符"></a>1.2.2 对象的属性描述符</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var obj = &#123;name: &apos;aaa&apos;&#125;;</span><br><span class="line"></span><br><span class="line">Object.getOwnPropertyDescriptor(obj, &quot;name&quot;);</span><br><span class="line"></span><br><span class="line">// &#123;</span><br><span class="line">//     value: &apos;aaa&apos;,</span><br><span class="line">//     writable: true,</span><br><span class="line">//     enumerable: true,</span><br><span class="line">//     configurable: true</span><br><span class="line">// &#125;</span><br></pre></td></tr></table></figure>

<p>writable 决定是否可以修改属性值<br>configurable 为 true， 可用 Object.defineProperty 来修改属性描述符<br>enumerable 是否可枚举，影响对象 for…in 循环</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var obj = &#123;</span><br><span class="line">    a: 2,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.log(&apos;a&apos; in obj); // true</span><br><span class="line">console.log(&apos;b&apos; in obj); // false</span><br><span class="line"></span><br><span class="line">console.log(obj.hasOwnProperty(a)) // true</span><br><span class="line">console.log(obj.hasOwnProperty(b)) // false</span><br><span class="line"></span><br><span class="line">// in 会检查属性是否在对象或原型链上， hasOwnProperty检查属性是否在当前对象上</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">var myArray = [ 1, 2, 3 ];</span><br><span class="line">var it = myArray[Symbol.iterator]();</span><br><span class="line">it.next(); // &#123; value:1, done:false &#125;</span><br><span class="line">it.next(); // &#123; value:2, done:false &#125;</span><br><span class="line">it.next(); // &#123; value:3, done:false &#125;</span><br><span class="line">it.next(); // &#123; done:true &#125;</span><br><span class="line"></span><br><span class="line">// 数组内部有@@iterator属性， 可以进行es6的for...of遍历</span><br><span class="line"></span><br><span class="line">// 可以给予想遍历的对象添加@@iterator属性</span><br><span class="line"></span><br><span class="line">var obj = &#123;</span><br><span class="line">    a: 2,</span><br><span class="line">    b: 3</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Object.defineProperty(obj, Symbol.iterator, &#123;</span><br><span class="line">    enumerable: false,</span><br><span class="line">    writable: false,</span><br><span class="line">    configurable: true,</span><br><span class="line">    value: function() &#123;</span><br><span class="line">        var o = this;</span><br><span class="line">        var idx = 0;</span><br><span class="line">        var ks = Object.keys(o);</span><br><span class="line">        return &#123;</span><br><span class="line">            next: function() &#123;</span><br><span class="line">                return &#123;</span><br><span class="line">                    value: o[ks[idx]],</span><br><span class="line">                    done: idx &gt; ks.length</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">var it = obj[Symbol.iterator](); </span><br><span class="line">it.next(); // &#123; value:2, done:false &#125; </span><br><span class="line">it.next(); // &#123; value:3, done:false &#125; </span><br><span class="line">it.next(); // &#123; value:undefined, done:true &#125;</span><br><span class="line">// 用 for..of 遍历 obj </span><br><span class="line">for (var v of obj) &#123; </span><br><span class="line">    console.log( v );</span><br><span class="line">&#125;</span><br><span class="line">// 2 // 3</span><br></pre></td></tr></table></figure>

<h5 id="1-2-3-属性设置和屏蔽"><a href="#1-2-3-属性设置和屏蔽" class="headerlink" title="1.2.3 属性设置和屏蔽"></a>1.2.3 属性设置和屏蔽</h5><p>如果 foo 不直接存在于 myObject 中而是存在于原型链上层时 myObject.foo = “bar” 会出现的三种情况。</p>
<ol>
<li>如果在[[Prototype]]链上层存在名为foo的普通数据访问属性(参见第3章)并且没有被标记为只读(writable:false)，那就会直接在 myObject 中添加一个名为 foo 的新 属性，它是屏蔽属性。</li>
<li>如果在[[Prototype]]链上层存在foo，但是它被标记为只读(writable:false)，那么 无法修改已有属性或者在 myObject 上创建屏蔽属性。如果运行在严格模式下，代码会 抛出一个错误。否则，这条赋值语句会被忽略。总之，不会发生屏蔽。</li>
<li>如果在[[Prototype]]链上层存在foo并且它是一个setter(参见第3章)，那就一定会 调用这个 setter。foo 不会被添加到(或者说屏蔽于)myObject，也不会重新定义 foo 这 个 setter。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/wangqinyong1994/blog/2019/07/29/对象/" data-id="ckh90iltj00083ncw3kd9ekvx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/上卷-对象/">上卷 对象</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-作用域和闭包" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2019/07/14/作用域和闭包/" class="article-date">
  <time datetime="2019-07-14T15:05:28.000Z" itemprop="datePublished">2019-07-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2019/07/14/作用域和闭包/">读读 作用域和闭包</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="1-作用域是啥玩意"><a href="#1-作用域是啥玩意" class="headerlink" title="1.作用域是啥玩意"></a>1.作用域是啥玩意</h4><h5 id="开始你的表演"><a href="#开始你的表演" class="headerlink" title="开始你的表演"></a>开始你的表演</h5><hr>
<h6 id="1）js编译原理-分词-语法分析-gt-解析-语法分析-gt-代码生成"><a href="#1）js编译原理-分词-语法分析-gt-解析-语法分析-gt-代码生成" class="headerlink" title="1）js编译原理 分词/语法分析 =&gt; 解析/语法分析 =&gt; 代码生成"></a>1）js编译原理 分词/语法分析 =&gt; 解析/语法分析 =&gt; 代码生成</h6><h5 id="分词词法分析，就是将语句分解成一块一块的，好好的-var-a-2-变成了-var、-a、-、-2、-做完这一步，-就到了解析-语法分析环节，这就要将词法单元流，转化成抽象语法树（AST），最后一步就是将这个树转换为可执行代码。"><a href="#分词词法分析，就是将语句分解成一块一块的，好好的-var-a-2-变成了-var、-a、-、-2、-做完这一步，-就到了解析-语法分析环节，这就要将词法单元流，转化成抽象语法树（AST），最后一步就是将这个树转换为可执行代码。" class="headerlink" title="分词词法分析，就是将语句分解成一块一块的，好好的 var a = 2;变成了 var、 a、 =、 2、 ;, 做完这一步， 就到了解析/语法分析环节，这就要将词法单元流，转化成抽象语法树（AST），最后一步就是将这个树转换为可执行代码。"></a>分词词法分析，就是将语句分解成一块一块的，好好的 <code>var a = 2;</code>变成了 <code>var、 a、 =、 2、 ;</code>, 做完这一步， 就到了解析/语法分析环节，这就要将<strong>词法单元流</strong>，转化成<strong>抽象语法树（AST）</strong>，最后一步就是将这个树转换为可执行代码。</h5><p>个人BB:<br>1.凡是这种树状结构的，类似vdom， 小程序的richText，都是一种中间层的转换，转换完之后再进行特定编译，这个中间商好像不赚差价。(*￣rǒ￣)<br>2.github有个<a href="https://github.com/benjamn/recast">recast库</a>，就是完成上述操作的，对于了解原理还是很好的，有机会再看 = =。</p>
<h6 id="2）变量赋值操作-当前作用域声明一个变量-gt-运行时在作用域中查找该变量-gt-找到赋值。-很简单，-这时候引入一个LHS-左查-与RHS-右查-的概念。"><a href="#2）变量赋值操作-当前作用域声明一个变量-gt-运行时在作用域中查找该变量-gt-找到赋值。-很简单，-这时候引入一个LHS-左查-与RHS-右查-的概念。" class="headerlink" title="2）变量赋值操作: 当前作用域声明一个变量 =&gt; 运行时在作用域中查找该变量 =&gt; 找到赋值。 很简单， 这时候引入一个LHS(左查)与RHS(右查)的概念。"></a>2）变量赋值操作: 当前作用域声明一个变量 =&gt; 运行时在作用域中查找该变量 =&gt; 找到赋值。 很简单， 这时候引入一个LHS(左查)与RHS(右查)的概念。</h6><p>左查，变量出现在赋值操作左侧；右查反之。<br>直接拿书里的例子来说</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function foo(a) &#123;</span><br><span class="line">    var b = a;</span><br><span class="line">    return a + b;</span><br><span class="line">&#125;</span><br><span class="line">var c = foo(2)</span><br><span class="line">// LHS: c = .. ;、 a = 2、 b = ..</span><br><span class="line">// RHS: foo(2.. 、 = 2 、 a.. 、 b..</span><br></pre></td></tr></table></figure>

<p>非严格模式下<br>左查失败时候，隐式创建全局变量<br>右查失败时候，抛出异常 referenceError, eg. xxx is not undefined</p>
<h6 id="3）-作用域嵌套-一个块或者函数嵌套在另一个块或者函数中。"><a href="#3）-作用域嵌套-一个块或者函数嵌套在另一个块或者函数中。" class="headerlink" title="3） 作用域嵌套: 一个块或者函数嵌套在另一个块或者函数中。"></a>3） 作用域嵌套: 一个块或者函数嵌套在另一个块或者函数中。</h6><p>想象成一个大建筑(全局)立面的n多小房间(局部块级作用域)。</p>
<h4 id="2-词法作用域"><a href="#2-词法作用域" class="headerlink" title="2.词法作用域"></a>2.词法作用域</h4><h5 id="1）上码分析起来"><a href="#1）上码分析起来" class="headerlink" title="1）上码分析起来"></a>1）上码分析起来</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function foo(a) &#123;</span><br><span class="line">    var b = a * 2;</span><br><span class="line">    </span><br><span class="line">    function bar(c) &#123;</span><br><span class="line">        console.log(a, b, c)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bar(b * 3)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo(2); // 2, 4, 12</span><br></pre></td></tr></table></figure>

<p>由最内部函数开始找变量，里面找不到找外面， a找到最外面2， b在bar外部foo内部， 找到赋值4， c为入参， 4*3赋值12.</p>
<p><strong>注意事项： 作用域查找会在找到第一个匹配的标识符停止。 学名”遮蔽效应”。</strong></p>
<h5 id="2）欺骗词法-eval-with-运行时创建新的词法作用域"><a href="#2）欺骗词法-eval-with-运行时创建新的词法作用域" class="headerlink" title="2）欺骗词法 eval with 运行时创建新的词法作用域"></a>2）欺骗词法 eval with 运行时创建新的词法作用域</h5><p>eval内部可执行代码，借此改变已存在的词法作用域。<br>with通过将一个对象的引用当做作用域来处理， 将对象属性当做作用域中的标识符处理，从而创建了一个新的词法作用域。</p>
<p>eg.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function foo(str, a) &#123;</span><br><span class="line">    eval(str);</span><br><span class="line">    console.log(a, b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var b = 2;</span><br><span class="line"></span><br><span class="line">foo(&quot;var b = 3;&quot;, 1); // 1, 3</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function foo(obj) &#123;</span><br><span class="line">    with(obj) &#123;</span><br><span class="line">        a = 2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var o1 = &#123;</span><br><span class="line">    a: 3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var o2 = &#123;</span><br><span class="line">    b: 3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo(o1);</span><br><span class="line">console.log(o1.a); // 2</span><br><span class="line"></span><br><span class="line">foo(o2);</span><br><span class="line">console.log(o2.a); // undefined</span><br><span class="line">console.log(a); // 2 a泄露到了全局作用域上</span><br><span class="line"></span><br><span class="line">// 原因： with可以将一个没有或有多个属性的对象处理为一个完全隔离的词法作用域。 没有o2.a，就创建一个a并且赋值2。</span><br></pre></td></tr></table></figure>

<hr>
<h6 id="let块变形"><a href="#let块变形" class="headerlink" title="let块变形"></a>let块变形</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">var foo = true;</span><br><span class="line"></span><br><span class="line">if(foo) &#123;</span><br><span class="line">    let bar = foo * 2;</span><br><span class="line">    bar = something(bar);</span><br><span class="line">    console.log(bar);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.log(bar); // ReferenceError</span><br><span class="line"></span><br><span class="line">// if语句同下面</span><br><span class="line"></span><br><span class="line">if(foo) &#123;</span><br><span class="line">    // let的作用</span><br><span class="line">    &#123;</span><br><span class="line">        let bar = foo * 2;</span><br><span class="line">        bar = something(bar);</span><br><span class="line">        console.log(bar)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.log(bar); // ReferenceError</span><br></pre></td></tr></table></figure>

<hr>
<h6 id="let-循环"><a href="#let-循环" class="headerlink" title="let 循环"></a>let 循环</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">for(let i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">    console.log(i) // 0-9 每次迭代重新绑定</span><br><span class="line">&#125;</span><br><span class="line">console.log(i) // ReferenceError</span><br><span class="line"></span><br><span class="line">// 等同于</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    let j;</span><br><span class="line">    for(j = 0; j &lt; 10; j++) &#123;</span><br><span class="line">        let i = j;</span><br><span class="line">        console.log(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="提升-先声明，后赋值"><a href="#提升-先声明，后赋值" class="headerlink" title="提升 (先声明，后赋值)"></a>提升 (先声明，后赋值)</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">foo(); // 1</span><br><span class="line"></span><br><span class="line">var foo;</span><br><span class="line"></span><br><span class="line">function foo() &#123;</span><br><span class="line">    console.log(1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo = function() &#123;</span><br><span class="line">    console.log(2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 加了打印成3了</span><br><span class="line">// function foo() &#123;</span><br><span class="line">//    console.log(3)</span><br><span class="line">// &#125;</span><br><span class="line"></span><br><span class="line">// 变量提升， 函数优先， 后写同名函数声明可以覆盖之前。</span><br></pre></td></tr></table></figure>

<p><strong>总而言之， 无论作用域中的声明出现在什么地方， 都将在代码本身被执行前首先进行处理。 可以将这个过程形象地想象成所有的声明(变量和函数)都会被移动到各自作用域的最顶端， 这个过程叫做提升。</strong></p>
<hr>
<h5 id="作用域闭包"><a href="#作用域闭包" class="headerlink" title="作用域闭包"></a>作用域闭包</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function foo() &#123;</span><br><span class="line">    var a = 2;</span><br><span class="line"></span><br><span class="line">    function bar() &#123;</span><br><span class="line">        console.log(a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return bar;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var baz = foo();</span><br><span class="line"></span><br><span class="line">baz(); // 2</span><br></pre></td></tr></table></figure>

<p><strong>无论通过何种手段将内部函数传递到所在的词法作用域以外， 它都会持有对原始定义作用域的引用， 无论在何处执行这个函数都会使用闭包。</strong><br><strong>函数嵌套函数， 叫做闭包。官方一点， 内部函数传递到了其所在的词法作用域之外，叫做闭包。</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/wangqinyong1994/blog/2019/07/14/作用域和闭包/" data-id="ckh90ilth00053ncwcaqfr25x" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/上卷-作用域和闭包/">上卷 作用域和闭包</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-this和原型对象" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2019/07/14/this和原型对象/" class="article-date">
  <time datetime="2019-07-14T15:04:14.000Z" itemprop="datePublished">2019-07-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2019/07/14/this和原型对象/">读读 this和原型对象</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="1-this和原型对象"><a href="#1-this和原型对象" class="headerlink" title="1.this和原型对象"></a>1.this和原型对象</h4><h5 id="开始你的表演"><a href="#开始你的表演" class="headerlink" title="开始你的表演"></a>开始你的表演</h5><hr>
<h5 id="1-this-概念一波"><a href="#1-this-概念一波" class="headerlink" title="1) this 概念一波"></a>1) this 概念一波</h5><p>this是在<strong>运行时绑定</strong>， 而非编写时绑定， 它的上下文取决于函数作用时的各种条件。this的绑定和函数声明的位置没有任何关系， 只取决于函数的调用方式。</p>
<p>当一个函数被调用时， 会创建一个活动记录， 包含函数调用栈， 调用方式， 传入的参数等信息。</p>
<h5 id="2）-this-绑定规则"><a href="#2）-this-绑定规则" class="headerlink" title="2） this 绑定规则"></a>2） this 绑定规则</h5><h6 id="2-1-默认绑定-就是一般的绑定规则-非严格模式下，-默认绑定到全局对象。"><a href="#2-1-默认绑定-就是一般的绑定规则-非严格模式下，-默认绑定到全局对象。" class="headerlink" title="2.1 默认绑定 就是一般的绑定规则 非严格模式下， 默认绑定到全局对象。"></a>2.1 默认绑定 就是一般的绑定规则 非严格模式下， 默认绑定到全局对象。</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function foo() &#123;</span><br><span class="line">    console.log(this.a);</span><br><span class="line">&#125;</span><br><span class="line">var a = 2;</span><br><span class="line">foo(); // 2</span><br></pre></td></tr></table></figure>

<h5 id="2-2-隐式绑定"><a href="#2-2-隐式绑定" class="headerlink" title="2.2 隐式绑定"></a>2.2 隐式绑定</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function foo() &#123;</span><br><span class="line">    console.log(this.a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var obj = &#123;</span><br><span class="line">    a: 2,</span><br><span class="line">    foo: foo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.foo(); // 2</span><br><span class="line">// 隐式绑定规则会把函数调用中的this绑定到这个上下文对象。</span><br></pre></td></tr></table></figure>

<hr>
<p>隐式丢失， 其实就是this上下文改变了， 随让this是谁调用就指向谁呢= =。<br>eg.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function foo() &#123;</span><br><span class="line">    console.log(this.a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function doFoo(fn) &#123;</span><br><span class="line">    fn()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var obj = &#123;</span><br><span class="line">    a: 2,</span><br><span class="line">    foo: foo</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var a = &apos;asdasd&apos;;</span><br><span class="line"></span><br><span class="line">doFoo(obj.foo); // asdasd</span><br></pre></td></tr></table></figure>

<h5 id="2-3-显示绑定-直接指定this的绑定对象，-即call、apply"><a href="#2-3-显示绑定-直接指定this的绑定对象，-即call、apply" class="headerlink" title="2.3 显示绑定  直接指定this的绑定对象， 即call、apply"></a>2.3 显示绑定  直接指定this的绑定对象， 即call、apply</h5><h6 id="2-3-1-硬绑定"><a href="#2-3-1-硬绑定" class="headerlink" title="2.3.1 硬绑定"></a>2.3.1 硬绑定</h6><p>典型应用场景： 创建一个包裹函数， 负责接收参数并返回值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function foo(something) &#123;</span><br><span class="line">    console.log(this.a, something);</span><br><span class="line">    return this.a + something</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var obj = &#123;</span><br><span class="line">    a: 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var bar = function() &#123;</span><br><span class="line">    return foo.apply(obj, arguments)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var b = bar(3); // 2 3</span><br><span class="line">console.log(b); // 5</span><br></pre></td></tr></table></figure>

<p>另 bind</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function foo(something) &#123;</span><br><span class="line">    console.log(this.a, something);</span><br><span class="line">    return this.a + something</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function bind(fn, obj) &#123;</span><br><span class="line">    return function() &#123;</span><br><span class="line">        return fn.apply(obj, arguments);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var obj = &#123;</span><br><span class="line">    a: 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var bar = bind(foo, obj);</span><br><span class="line"></span><br><span class="line">var b = bar(3); // 2 3</span><br><span class="line">console.log(b); // 5</span><br></pre></td></tr></table></figure>

<h5 id="2-4-new绑定"><a href="#2-4-new绑定" class="headerlink" title="2.4 new绑定"></a>2.4 new绑定</h5><p>回顾一波new干了些啥<br>1.创建一个全新的对象<br>2.这个新对象会被执行[[Prototype]]连接<br>3.这个新对象会绑定到函数调用的this<br>4.如果函数没有返回其他对象， 那么new表达式中的函数调用会自动返回这个新对象。</p>
<h5 id="2-5-软绑定"><a href="#2-5-软绑定" class="headerlink" title="2.5 软绑定"></a>2.5 软绑定</h5><h2 id="硬绑定会降低函数灵活性，-使用硬绑定之后无法使用隐式绑定或显示绑定修改this，如果可以给默认绑定指定一个全局对象和undefined以外的值，-可以实现相同效果，-同时保留隐式绑定或显示绑定修改this的能力。"><a href="#硬绑定会降低函数灵活性，-使用硬绑定之后无法使用隐式绑定或显示绑定修改this，如果可以给默认绑定指定一个全局对象和undefined以外的值，-可以实现相同效果，-同时保留隐式绑定或显示绑定修改this的能力。" class="headerlink" title="硬绑定会降低函数灵活性， 使用硬绑定之后无法使用隐式绑定或显示绑定修改this，如果可以给默认绑定指定一个全局对象和undefined以外的值， 可以实现相同效果， 同时保留隐式绑定或显示绑定修改this的能力。"></a>硬绑定会降低函数灵活性， 使用硬绑定之后无法使用隐式绑定或显示绑定修改this，<strong>如果可以给默认绑定指定一个全局对象和undefined以外的值</strong>， 可以实现相同效果， 同时保留隐式绑定或显示绑定修改this的能力。</h2><p>上代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">if(!Function.prototype.softBind) &#123;</span><br><span class="line">    Function.prototype.softBind = function(obj) &#123;</span><br><span class="line">        var fn = this;</span><br><span class="line">        var curried = [].slice.call(arguments, 1);</span><br><span class="line">        var bound = function() &#123;</span><br><span class="line">            return fn.apply(</span><br><span class="line">                (!this || this === (window || global)) ?</span><br><span class="line">                obj : this,</span><br><span class="line">                curried.concat.apply(curried, arguments)</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">        bound.prototype = Object.create(fn.prototype);</span><br><span class="line">        return bound;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 没看懂， 先放着。。。</span><br><span class="line">// 使用</span><br><span class="line"></span><br><span class="line">function foo() &#123;</span><br><span class="line">    console.log(&quot;name&quot; + this.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var obj = &#123;name: &apos;obj&apos;&#125;, obj2 = &#123;name: &apos;obj2&apos;&#125;, obj3 = &#123;name: &apos;obj3&apos;&#125;;</span><br><span class="line"></span><br><span class="line">var fooObj = foo.softBind(obj);</span><br><span class="line"></span><br><span class="line">fooObj(); // obj</span><br><span class="line"></span><br><span class="line">obj2.foo = foo.softBind(obj);</span><br><span class="line">obj2.foo(); // obj2</span><br><span class="line"></span><br><span class="line">fooObj.call(obj3); // obj3</span><br><span class="line"></span><br><span class="line">setTimeout(obj.foo, 10); // obj</span><br></pre></td></tr></table></figure>

<p>晚点消化。。。mark</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/wangqinyong1994/blog/2019/07/14/this和原型对象/" data-id="ckh90iltg00043ncw7kx9c3ce" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/上卷-this-原型对象/">上卷 this 原型对象</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2019/07/14/hello-world/" class="article-date">
  <time datetime="2019-07-14T14:46:07.586Z" itemprop="datePublished">2019-07-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2019/07/14/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/wangqinyong1994/blog/2019/07/14/hello-world/" data-id="ckh90iltb00013ncwtzmhu1wn" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-读读-我不知道的JavaScript" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2019/07/14/读读-我不知道的JavaScript/" class="article-date">
  <time datetime="2019-07-14T10:41:37.000Z" itemprop="datePublished">2019-07-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2019/07/14/读读-我不知道的JavaScript/">读读 我不知道的JavaScript</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="先拿我不知道js试试水-o-≧▽≦-ツ┏━┓"><a href="#先拿我不知道js试试水-o-≧▽≦-ツ┏━┓" class="headerlink" title="先拿我不知道js试试水 o(*≧▽≦)ツ┏━┓"></a>先拿我不知道js试试水 o(*≧▽≦)ツ┏━┓</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/wangqinyong1994/blog/2019/07/14/读读-我不知道的JavaScript/" data-id="ckh90ilto000f3ncwoz5y0qwe" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/你不知道的JavaScript/">你不知道的JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="extend next" rel="next" href="/blog/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/webpack/">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/上卷-this-原型对象/">上卷 this 原型对象</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/上卷-作用域和闭包/">上卷 作用域和闭包</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/上卷-对象/">上卷 对象</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/中卷-异步与性能/">中卷 异步与性能</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/中卷-类型-值/">中卷 类型 值</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/你不知道的JavaScript/">你不知道的JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/前端-工程化-npm/">前端 工程化 npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/前端-设计模式/">前端 设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/序/">序</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/blog/tags/上卷-this-原型对象/" style="font-size: 10px;">上卷 this 原型对象</a> <a href="/blog/tags/上卷-作用域和闭包/" style="font-size: 10px;">上卷 作用域和闭包</a> <a href="/blog/tags/上卷-对象/" style="font-size: 10px;">上卷 对象</a> <a href="/blog/tags/中卷-异步与性能/" style="font-size: 10px;">中卷 异步与性能</a> <a href="/blog/tags/中卷-类型-值/" style="font-size: 10px;">中卷 类型 值</a> <a href="/blog/tags/你不知道的JavaScript/" style="font-size: 10px;">你不知道的JavaScript</a> <a href="/blog/tags/前端-工程化-npm/" style="font-size: 10px;">前端 工程化 npm</a> <a href="/blog/tags/前端-设计模式/" style="font-size: 10px;">前端 设计模式</a> <a href="/blog/tags/序/" style="font-size: 10px;">序</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2019/07/">July 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2020/10/14/设计模式/">前端路线</a>
          </li>
        
          <li>
            <a href="/blog/2020/07/14/关于npm/">前端路线</a>
          </li>
        
          <li>
            <a href="/blog/2019/09/15/异步与性能/">异步与性能</a>
          </li>
        
          <li>
            <a href="/blog/2019/09/07/webpack相关/">webpack相关</a>
          </li>
        
          <li>
            <a href="/blog/2019/09/03/类型与语法/">类型与语法</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 WangQinyong<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js"></script>



  </div>
</body>
</html>